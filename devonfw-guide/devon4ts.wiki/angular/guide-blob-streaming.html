<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Angular File Uploading</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body id="devonfw-guide_devon4ts.wiki_angular_guide-blob-streaming.asciidoc" class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://www.katacoda.com/devonfw">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This sample demonstrates how to upload a file to a server. For this, we will need to use an Angular form. In this case we have chosen a simple template-driven form, as the goal of this sample is just to show the process to upload a file. You can learn more about Forms in Angular in the <a href="https://angular.io/guide/forms-overview">official documentation</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
The back-end implementation for this sample is located here: <a href="https://github.com/devonfw-sample/devon4j-blob-streaming">
devon4j-blob-streaming</a>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_angular_guide-blob-streaming.asciidoc_formdata"><code>FormData</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>FormData</code> is an object where you can store key-value pairs that allows you to send through <code>XMLHttpRequest</code>. You can create a <code>FormData</code> object as simply as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
const formData = new FormData();
formData.append('key', value);
....</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_angular_guide-blob-streaming.asciidoc_lets-begin">Let&#8217;s begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I assume you already have your angular application running, if not, you can have a look to our  <code>AngularBasicPWA</code> sample
Unresolved directive in guide-blob-streaming.asciidoc - include::guide-angular-pwa.asciidoc[leveloffset=2]</p>
</div>
<div class="paragraph">
<p>We are going to use Angular Material components, so it is necessary to install the dependency with the following command:</p>
</div>
<div class="paragraph">
<p><code>npm install --save @angular/material @angular/cdk @angular/animations</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_angular_guide-blob-streaming.asciidoc_importing-necessary-components">Importing necessary components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>These are the component I am going to use for our sample, are material HTML components. For use the template-driven form you do not need to import any component. I am going to create a module called Core where I place the needed imports. After that, I will import Core module on my main App module, and I be able to use these components in any part of my application.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
@NgModule({
  declarations: [],
  imports: [CommonModule],
  exports: [
    MatButtonModule,
    MatFormFieldModule,
    MatInputModule,
    FormsModule,
    MatProgressBarModule,
  ],
})
export class CoreModule {}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>FormsModule</code> Will allow us data binding through html and component.</p>
</div>
<div class="paragraph">
<p>The next step will be to create a component to place the uploading component:
<code>ng generate component uploader</code></p>
</div>
<div class="paragraph">
<p>So this will be our project structure so far:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/blob-streaming/folder-structure.PNG" alt="folder structure" width="300">
</div>
</div>
<div class="paragraph">
<p>Then, in the app.component.html we need to add the selector for our new component, so it will be represented there. We are not going to create any route for this sample. We can also modify the values for the toolbar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">....
&lt;div class="toolbar" role="banner"&gt;
  &lt;img
    width="40"
    alt="Angular Logo"
    src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg=="
  /&gt;
  &lt;span&gt;File uploader&lt;/span&gt;
&lt;/div&gt;

&lt;app-uploader&gt;&lt;/app-uploader&gt;

&lt;router-outlet&gt;&lt;/router-outlet&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, our new component <code>uploader</code> will be loaded in the root page. Let&#8217;s add some code to it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4ts.wiki_angular_guide-blob-streaming.asciidoc_uploader-component">Uploader component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I will begin editing the html file. First thing we need is an input component, which will allow us to select the file to upload. Furthermore, I added a button which will be the responsible of calling the upload file window. Apart from this, there is also two labels and a progress bar. Labels will give feedback about file upload request, both with an <code>if</code> clause with <code>uploadSuccess</code> and <code>uploadFail</code> global variables that will be in <code>uploader.component.ts</code>. The progress bar will show the progress of the file being uploaded.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="html language-html">....
  &lt;div class="upload"&gt;
    &lt;div&gt;
      &lt;button mat-raised-button (click)="upload()"&gt;Upload file&lt;/button&gt;
    &lt;/div&gt;
        &lt;label mat-label *ngIf="uploadSuccess"
      &gt;The file was upload succesfully!&lt;/label
    &gt;
    &lt;label mat-label *ngIf="uploadFail"
      &gt;There was an error uploading the file&lt;/label
    &gt;
    &lt;input
      type="file"
      #fileUpload
      name="fileUpload"
      accept="*"
      style="display: none"
    /&gt;
  &lt;/div&gt;
    &lt;mat-progress-bar
    *ngIf="fileInProgress"
    [value]="fileProgress"
  &gt;&lt;/mat-progress-bar&gt;
&lt;/div&gt;
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>The button will call the upload() method in our <code>uploader.component.ts</code>, and as we can see, I assigned an identifier for the input, <code>#fileUpload</code>, so we can reference it from <code>uploader.component.ts</code>. It accepts any file, and the display none style is because it will be called when we click the button, so it is no necessary to be present in the view.</p>
</div>
<div class="paragraph">
<p>Our html view should look something similar to this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/blob-streaming/html-view-1.PNG" alt="html view 1" width="600">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start in our .ts file. In order to interact with the input <code>#fileUpload</code>, it is necessary to declare it like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
@ViewChild('fileUpload') fileUpload: ElementRef;
constructor() {}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then, the upload() method that the button in html is calling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
 upload(): void {
    this.fileUpload.nativeElement.click();

    this.fileUpload.nativeElement.onchange = () =&gt; {
      const file = this.fileUpload.nativeElement.files[0];
      this.uploadFile(file);
    };
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>The click method at first line will open the file explorer in order to select the desired file to upload, and on change method will be called when a new file is selected, so a change is detected. Then, <code>uploadFile(&#8230;&#8203;)</code> method will be called.</p>
</div>
<div class="paragraph">
<p>Before explain this <code>uploadFile(&#8230;&#8203;)</code> method, there is something still missing, a service to communicate with back-end through HTTP.
I am going to place the service in a service folder inside our <code>uploader</code> component folder.
Execute the following command <code>ng generate service data</code> and paste the following code</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
export class DataService {
  SERVER_URL = 'http://localhost:8081/services/rest/binary/v1/';

  constructor(private httpClient: HttpClient) {}

  uploadFile(formdData: FormData): Observable&lt;HttpEvent&lt;BinaryObject&gt;&gt; {
    const headers = new HttpHeaders({
      'Content-Type': 'multipart/form-data',
    });

    return this.httpClient.post&lt;BinaryObject&gt;(
      this.SERVER_URL + 'binaryobject',
      formdData,
      {
        headers,
        reportProgress: true,
        observe: 'events',
      }
    );
  }
}
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have declared the URL as a global variable. Also is necessary to set the content-type as multipart/form-data in the headers sections, that will be the body of the request. There is also two options to talk about:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>reportProgress</code>: to have a feedback about the file upload so we can show percentage on the view.</p>
</li>
<li>
<p>observe: ' events' in order to receive this type of events information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <code>uploader.component.ts</code> is missing <code>uploadFile(&#8230;&#8203;)</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="typescript language-typescript">....
  uploadFile(file: File): void {
    const formDataBody = this.getFormData(file);
    this.dataService.uploadFile(formDataBody).subscribe(
      (event) =&gt; {
        if (event.type === HttpEventType.UploadProgress) {
          this.fileProgress = Math.round((100 * event.loaded) / event.total);
        } else if (event instanceof HttpResponse) {
          this.fileInProgress = false;
          this.uploadSuccess = true;
        }
      },
      (err) =&gt; {
        console.log('Could not upload the file!');
        this.uploadFail = true;
      }
    );
  }
....</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that whether we have a correct response, or an error response, we set the variable <code>this.uploadSuccess</code> or <code>this.uploadFail</code> to show the labels in the html giving feedback.
Once we call the service to do the HTTP request, we expect two types of response(three if we count the error), the first one is the progress of the upload, and will update the progress bar through <code>this.fileProgress</code> variable. The second one is a response when the request is finished.
That is why the type of the response is checked between <code>HttpEventType</code> or <code>HttpResponse</code>.</p>
</div>
<div class="paragraph">
<p>Now, if you have your back-end running, you should be able to upload a file, and check in DB that all the process worked fine.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Download method is not implemented yet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-03-30 15:47:06 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      }
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>