<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>How to use devon4net</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Lunr -->
<script src="/website/assets/scripts/lunr.min.js"></script>
<!-- JQuery -->
<script src="/website/assets/scripts/jquery.min.js"></script>
<link rel="stylesheet" href="/website/assets/styles/font-awesome.min.css">
<link rel="stylesheet" href="/website/assets/styles/googlecode.min.css">
<script src="/website/assets/scripts/highlight.min.js"></script>
<script src="/website/assets/scripts/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="/website/assets/styles/bootstrap.min.css">

<script src="/website/assets/scripts/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<script src="/website/shared/rightmenu.js"></script>

<!-- ************** Google analytics ************ -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

gtag('consent', 'default', {
  'analytics_storage': 'denied'
});
</script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>
<script>
  function consentGranted() {
    gtag('consent', 'update', {
      'analytics_storage': 'granted'
    });
  }
</script>

<!-- ******************************************** -->


</head>
<body id="devonfw-guide_devon4net.wiki_howto.asciidoc" class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="https://devonfw.com/website/pages/learning/">Tutorials</a></p>
</li>
<li>
<p><a href="/website/pages/solutions/index.html">Solutions</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Docs</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div id="preamble">
<div class="sectionbody">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_introduction">Introduction</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-create-a-new-devon4net-project">How to: Create a new devon4net project</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_command-line-interface-cli">Command Line Interface (CLI)</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-it-from-scratch-in-visual-studio-2022">Create it from scratch in Visual Studio 2022</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_unable-to-start-devon4net-template-on-macos-or-older-windows-versions">Unable to start devon4net template on macOS or older Windows Versions</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-create-and-add-certificates-to-a-project">How to: Create and add certificates to a project</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-certificate-using-openssl">Create a certificate using OpenSSL</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_add-certificates-to-a-devon4net-project">Add certificates to a devon4net project</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-setup-jwt">How to: Setup JWT</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_claims">Claims</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_jwthandler">JwtHandler</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-setup-security-and-roles-in-api-controllers">How to: Setup security and roles in API controllers</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_attributtes">Attributtes</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-configure-and-use-keycloak-server">How to: Configure and use Keycloak server</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-keycloak">What is Keycloak?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_docker-image">Docker Image</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_realms">Realms</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_clients">Clients</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_users">Users</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_groups">Groups</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_roles">Roles</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_hardcoded-audience">Hardcoded audience</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_keycloak-sample">Keycloak Sample</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_downloads">Downloads</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-avoid-cross-site-request-forgery-xsrf-or-csrf-attacks">How to: Avoid cross-site request forgery (XSRF or CSRF) attacks</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_use">Use</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_testing">Testing</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-import-a-database">How to: Import a database</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_prerequisites">Prerequisites</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_nuget-packages-installation">NuGet packages installation</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_scaffolding-command">Scaffolding command</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_add-the-context-for-dependency-injection">Add the context for Dependency Injection</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-litedb">How to: Use LiteDb</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-customize-headers">How to: Customize Headers</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-specflow">How to: Specflow</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_specflow-installation">Specflow Installation</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-specflow-project">Create specflow project</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-specflow-tests">Create specflow tests</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_run-the-tests">Run the tests</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_living-documentation">Living documentation</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-circuit-breaker-communication-with-certificates">How To: Circuit breaker communication with Certificates</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-rabbitmq">How to: RabbitMQ</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configure-the-server">Configure the Server</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configure-the-client">Configure the Client</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-kafka">How to: Kafka</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_previous-steps">Previous steps</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_producer">Producer</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_consumer">Consumer</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-nexus">How to: Use Nexus</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-protocol-buffers">How to: Protocol buffers</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_messages">Messages</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_services">Services</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-lambda-function">How to: AWS Lambda Function</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-a-lambda-function">What is a Lambda Function?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_install-the-aws-template-and-visual-studio-aws-tools">Install the AWS template and Visual Studio AWS tools</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-project-using-the-template">Create a project using the template</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_develop-your-first-function">Develop your first function</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-deploy-aws-lambda-functions">How to: Deploy AWS Lambda Functions</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_install-amazon-lambda-tools">Install Amazon Lambda Tools</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-console-portal-web">Deployment with AWS console portal (web)</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-cli">Deployment with AWS CLI</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-toolkit-for-visual-studio">Deployment with AWS Toolkit for Visual Studio</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-serverless">How to: AWS Serverless</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-a-serverless-architecture">What is a serverless architecture?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_install-the-aws-template-and-visual-studio-aws-tools">Install the AWS template and Visual Studio AWS tools</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-project-using-the-template">Create a project using the template</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-dynamodb">How to: AWS DynamoDB</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-amazon-dynamodb">What is Amazon DynamoDB?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_installing-the-nuget">Installing the nuget</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_working-with-table-repository">Working with Table Repository</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_working-with-entity-repository">Working with Entity Repository</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_searching-methods">Searching methods</a></li>
</ul>
</li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-aws-cdk">How to: Use AWS CDK</a>
<ul class="sectlevel2">
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-aws-cdk">What is AWS CDK?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_why-cdk-support-in-devon4net">Why CDK support in devon4net?</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use">How to use</a></li>
<li><a href="#devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you may know, <a href="https://devonfw.com/website/pages/docs/devonfw-guide_devon4net.wiki_master-devon4net.asciidoc.html">devon4net</a> is a framework that will assist you in getting started on your.NET applications and integrating high end configurable components.</p>
</div>
<div class="paragraph">
<p>This article contains information in the form of a step-by-step guide on how to do a variety of operations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-create-a-new-devon4net-project">How to: Create a new devon4net project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part, you will learn you how to easily create a new project using devon4net libraries and start working on it. You can create a variety of applications thanks to the different templates available. There are also multiple ways to create a new project, we will show you the most common ways.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
The configuration characteristics are not covered in this document. Please feel free to read the documentation for each component to discover how they work and the configuration options available.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_command-line-interface-cli">Command Line Interface (CLI)</h3>
<div class="paragraph">
<p>This is the fastest and most efficient way. You will be installing and starting a project thanks to the template available in the NuGet Gallery using CLI. For this part you will need to have .NET 6.0 SDK installed. You can run the following command to check your version:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; dotnet --version
6.0.102</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t get any response please follow the <a href="https://docs.microsoft.com/en-us/dotnet/core/install/">installation guide</a> provided by Microsoft to install the latest version of .Net SDK for your OS.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---install-the-template">Step 1 - Install the Template</h4>
<div class="paragraph">
<p>Open your favourite terminal (Windows/Linux/macOS) and run the command showed below to install the latest version of the the <a href="https://www.nuget.org/packages/Devon4Net.WebAPI.Template/">devon4net web API template</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; dotnet new --install Devon4Net.WebAPI.Template
The following template packages will be installed:
   Devon4Net.WebApI.Template

Success: Devon4Net.WebAPI.Template::6.0.3 installed the following templates:
Template Name                    Short Name    Language  Tags
-------------------------------  ------------  --------  ------------------------------
Devon4Net API solution template  Devon4NetAPI  [C#]      devonfw/Devon4Net/Devon4NetAPI</code></pre>
</div>
</div>
<div class="paragraph">
<p>We recommend you updating the template to the latest version. However, using the following option, you can select the version of your interest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; dotnet new --install Devon4Net.WebAPI.Template::6.0.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you will have the template available in your Visual Studio 2022. Just type <code>devon4net</code> in the search bar when creating a new project!</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/api_template_ide.png" alt="api template ide">
</div>
<div class="title">Figure 1. Devon4Net API template in VS2022</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-a-new-project">Step 2 - Create a new project</h4>
<div class="paragraph">
<p>To create a new project run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; dotnet new Devon4NetAPI
The template "Devon4Net API solution template" was created successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a project with the default name in the actual directory. If you want to specify the desired name and output directory you can specify the following options:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; dotnet new Devon4NetAPI --name MyProject --output C:\Projects\MyProject
The template "Devon4Net API solution template" was created successfully.</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can do it also choosing the template when creating a new project in Visual Studio 2022 as shown in figure 1, and configuring the name and output directory as shown in figure 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/api_template_configure.png" alt="api template configure">
</div>
<div class="title">Figure 2. Devon4Net API template in VS2022</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---run-it">Step 3 - Run it</h4>
<div class="paragraph">
<p>After running it with Kestrel you will be able to access to the swagger <code>index.html</code> and try the API in the following xref:devonfw-guide/devon4net.wiki_ <a href="https://localhost:8085/swagger/index.html">https://localhost:8085/swagger/index.html</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-it-from-scratch-in-visual-studio-2022">Create it from scratch in Visual Studio 2022</h3>
<div class="paragraph">
<p>This method is a little more time consuming, but it allows for a more customized configuration and project structure. You will be using Visual Studio 2022 to create the project and add everything you need by hand.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-a-new-project">Step 1 - Create a new project</h4>
<div class="paragraph">
<p>Create a new ASP.NET Core Web API project using the template provided by Visual Studio. You can type <code>api</code> in the search bar and select it as shown in figure 3.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/api_template_create_project.png" alt="api template create project">
</div>
<div class="title">Figure 3. ASP.NET Core Web API template in VS2022</div>
</div>
<div class="paragraph">
<p>Once you go through all the initial configuration process, choosing a name, location and so on; you will find your project as shown in the next image.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/api_template_initial_structure.png" alt="api template initial structure">
</div>
<div class="title">Figure 4. Default ASP.NET Core Web API template structure</div>
</div>
<div class="paragraph">
<p>You can delete both <code>WeatherForecastController.cs</code> and <code>WeatherForecast.cs</code> as they are an example in the template but we recommend you keeping them so you can try the API when done with all the steps.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---add-the-nuget-reference">Step 2 - Add the NuGet reference</h4>
<div class="paragraph">
<p>To install the NuGet package for the API Configuration we will use the Visual Studio package manager console. To open it, go to <code>View &gt; Other Windows &gt; Package Manager Console</code> as shown in the figure below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/api_template_package_manager.png" alt="api template package manager">
</div>
<div class="title">Figure 5. Package Manager Console location in menu</div>
</div>
<div class="paragraph">
<p>Now you can run the following command. It will take a minute to download and install all the packages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">PM&gt; install-package Devon4Net.Infrastructure.WebAPI</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once its done, you should be able to see the dependency in the Package Dependencies of the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---set-up-your-project">Step 3 - Set up your project</h4>
<div class="paragraph">
<p>Now you will need to add some configuration in the <code>Program.cs</code>. The following lines will initialize the configuration for the WebHostBuilder and configure the components that were imported with the NuGet installation respectively, making use of extensions methods for the <code>ServiceCollection</code> and <code>WebHostBuilder</code> classes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.WebHost.InitializeDevonFw();
builder.Services.ConfigureDevonFw(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you&#8217;ll need to configure the middlewares included with the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">app.SetupMiddleware(builder.Services);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Don&#8217;t forget to import the package to be able to use this methods!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is not necessary, but we recommend to also setup the logger so you can keep track of the trace running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupLog(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Program.cs</code> will end up looking like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using Devon4Net.Application.WebAPI.Configuration;
using Devon4Net.Application.WebAPI.Configuration.Application;
using Devon4Net.Infrastructure.Middleware.Middleware;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers();

// devon4net
builder.WebHost.InitializeDevonFw();
builder.Services.SetupLog(builder.Configuration);
builder.Services.SetupDevonfw(builder.Configuration);

var app = builder.Build();
app.UseHttpsRedirection();

// devon4net
app.SetupMiddleware(builder.Services);

app.UseAuthorization();

app.MapControllers();

app.Run();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---configure-components">Step 4 - Configure components</h4>
<div class="paragraph">
<p>The lines added on the previous step will need some configuration in the <code>appsettings.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "devonfw": {
    "UseDetailedErrorsKey": true,
    "UseIIS": false,
    "UseSwagger": true,
    "UseXsrf": true,
    "UseModelStateValidation": true,
    "Environment": "Development",
    "ForceUseHttpsRedirection": false,
    "Kestrel": {
      "UseHttps": true,
      "HttpProtocol": "Http1AndHttp2", //Http1, Http2, Http1AndHttp2, none
      "ApplicationPort": 8085,
      "SslProtocol": "Tls12", //Tls12, Tls13, none. For Https2 Tls12 is needed
      "ExtraSettings": {
        "KeepAliveTimeout": 120, //in seconds
        "MaxConcurrentConnections": 100,
        "MaxConcurrentUpgradedConnections": 100,
        "MaxRequestBodySize": 28.6, //In MB. The default maximum request body size is 30,000,000 bytes, which is approximately 28.6 MB
        "Http2MaxStreamsPerConnection": 100,
        "Http2InitialConnectionWindowSize": 131072, // From 65,535 and less than 2^31 (2,147,483,648)
        "Http2InitialStreamWindowSize": 98304, // From 65,535 and less than 2^31 (2,147,483,648)
        "AllowSynchronousIO": true
      }
    },
    "IIS": {
      "ForwardClientCertificate": true,
      "AutomaticAuthentication": true,
      "AuthenticationDisplayName": ""
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And also in the <code>appsettings.Development.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "ExtraSettingsFiles": [
    "appsettingsExtra.json",
    "Directory path",
    "Specific file name"
  ],
  "KillSwitch": {
    "UseKillSwitch": false,
    "EnableRequests": false,
    "HttpStatusCode": 403
  },
  "ConnectionStrings": {
    "Default": "Todos",
    "Employee": "Employee",
    "RabbitMqBackup": "Add your database connection string here for messaging backup",
    "MediatRBackup": "Add your databascere connection string here for messaging backup"
  },
  "Certificates": {
    "ServerCertificate": {
      "Certificate": "",
      "CertificatePassword": ""
    },
    "ClientCertificate": {
      "DisableClientCertificateCheck": true,
      "RequireClientCertificate": false,
      "CheckCertificateRevocation": true,
      "ClientCertificates": {
        "Whitelist": [
          "3A87A49460E8FE0E2A198E63D408DC58435BC501"
        ]
      }
    }
  },
  "Headers": {
    "AccessControlExposeHeader": "Authorization",
    "StrictTransportSecurityHeader": "",
    "XFrameOptionsHeader": "DENY",
    "XssProtectionHeader": "1;mode=block",
    "XContentTypeOptionsHeader": "nosniff",
    "ContentSecurityPolicyHeader": "",
    "PermittedCrossDomainPoliciesHeader": "",
    "ReferrerPolicyHeader": ""
  },
  "Cors": []
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_unable-to-start-devon4net-template-on-macos-or-older-windows-versions">Unable to start devon4net template on macOS or older Windows Versions</h3>
<div class="paragraph">
<p>If you try to execute the devon4net template on macOS or an earlier version of Windows, such as Windows 7, you will receive the following error message:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/Exception-DevonWebAPI-MacEnvironment.png" alt="Exception DevonWebAPI MacEnvironment">
</div>
</div>
<div class="paragraph">
<p>Because these operating systems lack ALPN(Application-Layer Protocol Negotiation) functionality, Kestrel does not handle HTTP/2 with TLS.</p>
</div>
<div class="paragraph">
<p>To resolve this, navigate to 'appsettings.json' and change the Kestrel configuration as seen below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "devonfw": {
    "UseDetailedErrorsKey": true,
    "UseIIS": false,
    "UseSwagger": true,
    "UseXsrf": true,
    "UseModelStateValidation": true,
    "Environment": "Development",
    "ForceUseHttpsRedirection": false,
    "Kestrel": {
      "UseHttps": true,
      "HttpProtocol": "Http1AndHttp2", //Http1, Http2, Http1AndHttp2, none
      "ApplicationPort": 8085,
      "SslProtocol": "none", //Tls12, Tls13, none. For Https2 Tls12 is needed
      "ExtraSettings": {
        "KeepAliveTimeout": 120, //in seconds
        "MaxConcurrentConnections": 100,
        "MaxConcurrentUpgradedConnections": 100,
        "MaxRequestBodySize": 28.6, //In MB. The default maximum request body size is 30,000,000 bytes, which is approximately 28.6 MB
        "Http2MaxStreamsPerConnection": 100,
        "Http2InitialConnectionWindowSize": 131072, // From 65,535 and less than 2^31 (2,147,483,648)
        "Http2InitialStreamWindowSize": 98304, // From 65,535 and less than 2^31 (2,147,483,648)
        "AllowSynchronousIO": true
      }
    },
    "IIS": {
      "ForwardClientCertificate": true,
      "AutomaticAuthentication": true,
      "AuthenticationDisplayName": ""
    }
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
HTTP/2 without TLS should only be used during app development. Production apps should always use transport security.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p>Here are some interesting references to continue learning about this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/dotnet/core/install/">Install .NET on your OS - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/core/tools/">.NET CLI overview - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/core/tools/dotnet-new-install">dotnet new --install option - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/core/tools/dotnet-new">dotnet new - Microsoft Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-create-and-add-certificates-to-a-project">How to: Create and add certificates to a project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part, you will learn how to easily create a new certificate and properly add it to your devon4net project.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-certificate-using-openssl">Create a certificate using OpenSSL</h3>
<div class="paragraph">
<p>In order to create our own certificate for development purposes we will be using <a href="https://github.com/openssl/openssl">OpenSSL</a> toolkit. To ensure correct behavior, make sure the tool is properly installed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the <a href="https://www.openssl.org/docs/man3.0/man1/">OpenSSL command documentation</a> to learn more about the commands used in this guide and how to install the toolkit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run commands for OpenSSL, you will need to add OpenSSL to your environment, variables, or open a OpenSSL command prompt.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
The working directory (directory where all files are created and readed) is the console actual path. Use <code>cd</code> command to go to your desired directory.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-a-certificate-authority-ca">Step 1 - Create a Certificate Authority (CA)</h4>
<div class="paragraph">
<p>First we will need to create a Certificate Authority to sign the certificate. For that, we will run the following command which will create the certificate <code>RootCA.pem</code> and the corresponding private key <code>RootCA.key</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl req -x509 -nodes -new -sha256 -days 1024 -newkey rsa:2048 -keyout RootCA.key -out RootCA.pem -subj "/C=ES/ST=Valencia/L=Valencia/O=Certificates/CN=MyProjectCertificate.local"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we will create the public key <code>RootCA.crt</code> for the certificate by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl x509 -outform pem -in RootCA.pem -out RootCA.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to export the certificate you can run the command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl pkcs12 -export -out RootCA.pfx -inkey RootCA.key -in RootCA.crt</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-a-certificate-signed-by-the-ca">Step 2 - Create a Certificate signed by the CA</h4>
<div class="paragraph">
<p>To create a new certificate run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl req -new -nodes -newkey rsa:2048 -keyout localhost.key -out localhost.csr -subj "/C=ES/ST=Valencia/L=Valencia/O=Certificates/CN=localhost.local"</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before signing it, create a <code>domains.ext</code> that contains the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="txt language-txt">authorityKeyIdentifier=keyid,issuer
basicConstraints=CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
subjectAltName = @alt_names
[alt_names]
DNS.1 = localhost
DNS.2 = localhost.local
DNS.3 = 127.0.0.1
DNS.4 = fake1.local
DNS.5 = fake2.local</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the files are created, you&#8217;ll need to sign the certificate with the CA we created earlier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl x509 -req -sha256 -days 1024 -in localhost.csr -CA RootCA.pem -CAkey RootCA.key -CAcreateserial -extfile domains.ext -out localhost.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run the next command to export the certificate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">&gt; openssl pkcs12 -export -out localhost.pfx -inkey localhost.key -in localhost.crt</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will end up having something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/certificates.png" alt="certificates">
</div>
<div class="title">Figure 6. Certification Authority (left) and localhost certificate signed by CA (right)</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_add-certificates-to-a-devon4net-project">Add certificates to a devon4net project</h3>
<div class="paragraph">
<p>Once you have created a certificate or in case you already have yours, you can add it to your project thanks to devon4net tools.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---add-it-to-your-project">Step 1 - Add it to your project</h4>
<div class="paragraph">
<p>Locate the Certificates directory in your startup project. If it doesn&#8217;t exist, please create it and drop your certificate <code>.pfx</code> as shown in figure 2.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/certificates_add.png" alt="certificates add">
</div>
<div class="title">Figure 7. Certificates directory in startup project</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---configure-your-appsettings">Step 2 - Configure your appsettings</h4>
<div class="paragraph">
<p>Now configure your certificate in <code>appsettings.Development.json</code>. For that, you&#8217;ll need to specify the file name and the password you chose. Look for the <code>ServerCertificate</code> configuration and add something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Certificates": {
    "ServerCertificate": {
        "Certificate": "localhost.pfx",
        "CertificatePassword": "12345"
    },
    "ClientCertificate": {
        "DisableClientCertificateCheck": true,
        "RequireClientCertificate": false,
        "CheckCertificateRevocation": true,
        "ClientCertificates": {
        "Whitelist": [
            "3A87A49460E8FE0E2A198E63D408DC58435BC501"
            ]
        }
    }
},</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p>Here are some interesting references to continue learning about this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/openssl/openssl">OpenSSL</a></p>
</li>
<li>
<p><a href="https://www.openssl.org/docs/man1.0.2/man1/openssl-req.html"><code>req</code> command documentation - OpenSSL Docs</a></p>
</li>
<li>
<p><a href="https://www.openssl.org/docs/man1.0.2/man1/x509.html"><code>x509</code> command documentation - OpenSSL Docs</a></p>
</li>
<li>
<p><a href="https://www.openssl.org/docs/man3.0/man1/pkcs12.html"><code>pkcs12</code> command documentation - OpenSSL Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-setup-jwt">How to: Setup JWT</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you may have learned at this point you can set up JWT component in a number of different ways according your needs. For that you&#8217;ll need to configure your <code>appsettings.json</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please read documentation about JWT component first to learn what you need to do to use it in your project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assuming that you already have the JWT component correctly installed and available in our project let&#8217;s start thinking about how we can put it to good use.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>We can configure it to work either with a secret key or a certificate.</p>
</div>
<div class="paragraph">
<p>If you choose certificate, you will need to add a certificate to your project, and specify the password and the encryptionAlgorithm used. You can learn how to do it following the tutorial included in this document.</p>
</div>
<div class="paragraph">
<p>If you specify both, the secret key will take priority.</p>
</div>
<div class="paragraph">
<p>For example lets specify the next:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/json_jwt_example.png" alt="json jwt example">
</div>
<div class="title">Figure 8. JWT configuration example</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
The property <code>SecretKey</code> needs to be an encrypted key using the algorithm specified.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This would create the following configuration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A token with audience and issuer equal to <code>devon4net</code>.</p>
</li>
<li>
<p>It will expire in 60 minutes</p>
</li>
<li>
<p>It will validate the signature and if the token is valid in time</p>
</li>
<li>
<p>It will require tokens that are signed, and have both expiration time and audience specified.</p>
</li>
<li>
<p>It will use the secret key encrypted with SHA 512</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_claims">Claims</h3>
<div class="paragraph">
<p>Json Web Tokens work with claims. A Claim is a piece of information about a subject. It is similar to a key-value pair, where the value will be the claim type, such as the name or the role of an authenticated user. This claims are stored inside a JSON and then encrypted forming the JWT.</p>
</div>
<div class="paragraph">
<p>In .Net we can create Claims using the <code>Claim</code> class avaiable in <code>System.Security.Claims</code>. It has many constructors but the most important is the following one, where you can create a Claim based on two strings.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">var nameClaim = new Claim(ClaimType.Name, "DevonUser");
var roleClaim = new Claim(ClaimType.Role, "Administrator");</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can choose between a variety of claim types thanks to the <code>ClaimType</code> class. As you can see in the previous piece of code, in this case we have asserted a name and a role in two claims. This could be for a user, for example.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_jwthandler">JwtHandler</h3>
<div class="paragraph">
<p>In JWT component we have a handler that is cofigured on the installation of the package and can be injected for use in any wanted service. This is the <code>JwtHandler</code>. This handler will allow us to manipulate, encrypt and extract information from Json Web Tokens.</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Return Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Method Name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Parameters</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CreateJwtToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Claim&gt; clientClaims</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the encrypted jwt given a list of claims.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Claim&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GetUserClaims</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string jwtToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a list of claims given an encrypted token.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GetClaimValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List&lt;Claim&gt; claimList, string claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of a claim given a list of claims and the type of the claim to recover formatted as a string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GetClaimValue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string token, string claim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the value of a claim given an encrypted token and the type of the claim to recover formatted as a string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SecurityKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GetIssuerSigningKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the issuer&#8217;s signing key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ValidateToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string jwtToken, out ClaimsPrincipal claimsPrincipal, out SecurityToken securityToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns true if the token is valid.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CreateRefreshToken</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a refresh token for the JWT token.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</h3>

</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p>Here are some interesting references to continue learning about this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://auth0.com/docs/secure/tokens/json-web-tokens/json-web-token-claims">JSON Web Token Claims - auth0</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/api/system.security.claims.claim?view=net-6.0">Claim Class - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/api/system.security.claims.claimtypes?view=net-6.0">ClaimTypes Class - Microsoft Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-setup-security-and-roles-in-api-controllers">How to: Setup security and roles in API controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document, you will learn to use the different attributes over the controller methods that manage end-points. This attributes are provided by .Net core libraries and can be used to specify the behavior of Web API controllers and action methods.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_attributtes">Attributtes</h3>
<div class="paragraph">
<p>You can use a large number of attributes, some are optional, for example to define the route of end-points <code>[Route("/GetSomething")]</code> and other are required, like <code>[ApiController]</code> to indicate that the class is an API controller.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
We will be explaining the security related attributes. Those that are specific to the controllers will not be mentioned.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a id="devonfw-guide_devon4net.wiki_howto.asciidoc_httpoptions"></a>]
==== [HttpOptions]</p>
</div>
<div class="paragraph">
<p>This attribute identifies an API controller end-point that support the HTTP OPTIONS request. The HTTP OPTIONS method is used to get information about the communication options available for a specific URL or server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please do your research on this method if you are not familiar with it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a id="devonfw-guide_devon4net.wiki_howto.asciidoc_allowanonymous"></a>]
==== [AllowAnonymous]</p>
</div>
<div class="paragraph">
<p><code>AllowAnonymous</code> allows any type of user (authorized or unauthorized) to access the information provided by the end-point. This attribute can be specified for controller class or for individual end-points. Specifying it for individual end-points will override the controller attribute. An example could be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[HttpGet]
[AllowAnonymous]
[Route("/v1/getsomething")]
public async Task&lt;IActionResult&gt; GetSomething()
{
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a id="devonfw-guide_devon4net.wiki_howto.asciidoc_authorize"></a>]
==== [Authorize]</p>
</div>
<div class="paragraph">
<p><code>Authorize</code> only enables you to restrict access to requests with an authorization specified in the header. This attribute can be specified for controller class or for individual end-points. Specifying it for individual end-points will override the controller attribute. You can specify different properties to the attribute:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Property</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Type</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Example</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AuthenticationSchemes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of strings separated by comma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of schemes from which user info is constructed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[Authorize(AuthenticationSchemes = "Bearer")]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Policy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy name that determines access to the resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[Authorize(Policy = "MyPolicy")]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Roles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of strings separated by comma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of roles allowed to access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[Authorize(Roles = "User")]</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example, lets create a controller that is authorized only for users with role 'Admin' and 'Tester' provided in 'Bearer' type authentication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[ApiController]
[Route("[controller]")]
[Authorize(AuthenticationSchemes = "Berarer", Roles = "Admin,Tester")]
public class DebugController: ControllerBase
{
  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>[[devonfw-guide_devon4net.wiki_howto.asciidoc_enablecors&#8212;&#8203;disablecors]]]
==== [EnableCors] &amp; [DisableCors]</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the CORS component documentation to learn everything about CORS.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can enable a Cors policy for controller or individual end-points. Specifying it for individual end-points will override the controller attribute. You will need to specify the policy you want to enable. This policy will need to be described in the <code>appsettings.{environment}.json</code>.</p>
</div>
<div class="paragraph">
<p>For example, lets create a CORS policy named 'CorsPolicy' and enable it for a controller, and disable it for a method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Cors": //[], //Empty array allows all origins with the policy "CorsPolicy"
[
  {
    "CorsPolicy": "CorsPolicy",
    "Origins": "http://localhost:4200,https://localhost:4200,http://localhost,https://localhost;http://localhost:8085,https://localhost:8085",
    "Headers": "accept,content-type,origin,x-custom-header,authorization",
    "Methods": "GET,POST,HEAD,PUT,DELETE",
    "AllowCredentials": true
  }
],</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[ApiController]
[Route("[controller]")]
[EnableCors("CorsPolicy")]
public class MyController: ControllerBase
{
  ...
  [HttpGet]
  [Route("/v1/getsomething")]
  [DisableCors]
  public async Task&lt;IActionResult&gt; GetSomething()
  {
    ...
  }
  ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p>Here are some interesting references to continue learning about this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/introduction?view=aspnetcore-6.0">Introduction to authorization in ASP.NET Core - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-ES/dotnet/api/microsoft.aspnetcore.authorization?view=aspnetcore-6.0">Authorization Namespace - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/OPTIONS">HTTP OPTIONS - MDN Web Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-configure-and-use-keycloak-server">How to: Configure and use Keycloak server</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-keycloak">What is Keycloak?</h3>
<div class="paragraph">
<p>Keycloak is an open-source tool that provides identity and access management providing highly secure properties to your application.  It supports multiple protocols such as OAuth and OpenID. It has full support for SSO (Single Sign-On and Single Sign-Out) and third party Social Identity Providers such as Google, Twitter, Facebook&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>You can also connect it to some type of user database if you already have one for your client. This allows you to interconnect multiple applications through same users and data.</p>
</div>
<div class="paragraph">
<p>One of the most interesting features is the GUI available through and end-point that allows you to configure and manage your Keycloak settings and properties.</p>
</div>
<div class="paragraph">
<p>Long story short, Keycloak is a server that manages all your user related interactions, such as roles, groups, access tokens&#8230;&#8203; so you can focus in developing your application and don&#8217;t have to reinvent the wheel.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_docker-image">Docker Image</h3>
<div class="paragraph">
<p>For this example we will be running the Keycloak docker image and exposing it in a local port.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please make sure you have Docker installed in your machine before running the command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To start the Keycloak Server run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">docker run -p 8080:8080 -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin quay.io/keycloak/keycloak:18.0.1 start-dev</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
This whole guide is meant to be used with the Keycloak Server version <code>18.0.1</code>. It may not work in the same way in future versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will start the keycloak server in a docker image. It will be availabe in your localhost port 8080. As you can also see by the command, it will create an initial admin user with username <code>admin</code> and password <code>admin</code>. You can sign in navigating to the address <a href="http://localhost:8080/admin/">localhost:8080</a> and using this initial credentials.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_sign_in.png" alt="keycloak sign in">
</div>
<div class="title">Figure 9. Keycloak Sign In</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_realms">Realms</h3>
<div class="paragraph">
<p>In Keycloak, a realm is the same as an environment.  It enables the creation of exclusive groups of users and applications. In Keycloak, there is just one realm by default, named master. This is for managing Keycloak only, therefore don&#8217;t use it for your own programs.</p>
</div>
<div class="paragraph">
<p>To create a realm you can hover the small arrow where it says <code>Master</code> in the dashboard and click on <code>Add realm</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_create_realm.png" alt="keycloak create realm">
</div>
<div class="title">Figure 10. Create a realm in keycloak</div>
</div>
<div class="paragraph">
<p>Choose a name, for this example we will name it <code>MyRealm</code>, and then click <code>Create</code>.</p>
</div>
<div class="paragraph">
<p>Now when your realm is selected, you will be able to configure it through the <code>Realm Settings</code> tab in the left side menu.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please visit the Keycloak documentation to learn more about how you can configure it and what options do you have.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_clients">Clients</h3>
<div class="paragraph">
<p>A client, in Keycloak is equivalent to an application. You can add multiple applications and all can use the same users, groups, roles&#8230;&#8203;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_create_client.png" alt="keycloak create client">
</div>
<div class="title">Figure 11. Create a client in keycloak</div>
</div>
<div class="paragraph">
<p>Now fill the form choosing at least a required client id. You can also select the protocol you will be using:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>OpenID connect</code> allows Clients to verify the identity of the End-User based on the authentication performed by an Authorization Server.</p>
</li>
<li>
<p><code>SAML</code> enables web-based authentication and authorization scenarios including cross-domain single sign-on (SSO) and uses security tokens containing assertions to pass information.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_set_client.png" alt="keycloak set client">
</div>
<div class="title">Figure 12. Create a client in keycloak</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_users">Users</h3>
<div class="paragraph">
<p>To create a new user follow the next steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into the <a href="http://localhost:8080/admin/master/console/#/realms">Keycloak admin console</a></p>
</li>
<li>
<p>Select the Realm in which you want to create users:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_1.png" alt="keycloak user 1">
</div>
<div class="title">Figure 13. Keycloak administrator console</div>
</div>
</li>
<li>
<p>Navigate to the <strong>Users</strong> section (1) in the left-side bar, then the <strong>Add user</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_2.png" alt="keycloak user 2">
</div>
<div class="title">Figure 14. Add a user in Keycloak</div>
</div>
</li>
<li>
<p>Complete the fields (1) and click the <strong>Save</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_3.png" alt="keycloak user 3">
</div>
<div class="title">Figure 15. Add a user in Keycloak</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The only required field is the username.</p>
</li>
<li>
<p>The required user actions field refers to some action that the user must perform upon first logging in.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Set a password for the user:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_4.png" alt="keycloak user 4">
</div>
<div class="title">Figure 16. Set credentials to a user in Keycloak</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <strong>Credentials</strong> tab (1).</p>
</li>
<li>
<p>Enter a password (2).</p>
</li>
<li>
<p>Confirm the password (3).</p>
</li>
<li>
<p>(<strong>Optional</strong>)
Change the switch to on if you want the user to change their password after the first login (4).</p>
</li>
<li>
<p>Click the <strong>Set Password</strong> button to confirm the changes (5).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_groups">Groups</h3>
<div class="paragraph">
<p>Groups in Keycloak allow you to manage a common set of attributes and role mappings for a set of users. Let&#8217;s create a new group and add some users inside:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Groups</strong> section (1) in the left-side bar, then the <strong>New</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_1.png" alt="keycloak group 1">
</div>
<div class="title">Figure 17. Create a group in Keycloak</div>
</div>
</li>
<li>
<p>Insert the name of the group and then click the <strong>Save</strong> button:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_2.png" alt="keycloak group 2">
</div>
<div class="title">Figure 18. Create a group in Keycloak</div>
</div>
</li>
<li>
<p>Groups are hierarchical. A group can have many subgroups, but a group can only have one parent. Subgroups inherit the attributes and role mappings from the parent. This applies to the user as well. By clicking in a group (1) and then clicking the <strong>New</strong> button (2), you can create a subgroup.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_3.png" alt="keycloak group 3">
</div>
<div class="title">Figure 19. Create a subgroup in Keycloak</div>
</div>
<div class="paragraph">
<p>For example, you could have something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_4.png" alt="keycloak group 4">
</div>
<div class="title">Figure 20. Create a group in Keycloak</div>
</div>
</li>
<li>
<p>Add users to the groups:</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <strong>Users</strong> section (1) in the left-side bar, then select the user you want to add to a group and click on the <strong>Edit</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_5.png" alt="keycloak group 5">
</div>
<div class="title">Figure 21. Add users to a group in Keycloak</div>
</div>
</li>
<li>
<p>Click the <strong>Groups</strong> tab (1), select the group in which the user should be added (2), and then click the <strong>Join</strong> button (3):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_6.png" alt="keycloak group 6">
</div>
<div class="title">Figure 22. Add users to a group in Keycloak</div>
</div>
</li>
<li>
<p>You will see something like this:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_group_7.png" alt="keycloak group 7">
</div>
<div class="title">Figure 23. Add users to a group in Keycloak</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_roles">Roles</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_realm-roles">Realm Roles</h4>
<div class="paragraph">
<p>Realm-level roles are a global namespace to define your roles. To add a new Real Role you have to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Roles</strong> section in the left-side bar (1), and click the <strong>Add Roles</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_1.png" alt="keycloak role 1">
</div>
<div class="title">Figure 24. Create a new Realm Role in Keycloak</div>
</div>
</li>
<li>
<p>Input a role name and click the <strong>Save</strong> button:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_2.png" alt="keycloak role 2">
</div>
<div class="title">Figure 25. Create a new Realm Role in Keycloak</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The description field is not required</p>
</li>
</ul>
</div>
</li>
<li>
<p>Now you may add users to that role as follows:</p>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <strong>Users</strong> section (1) and select the <strong>Edit</strong> button (2) for the user to whom you want to assign the role:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_3.png" alt="keycloak role 3">
</div>
<div class="title">Figure 26. adding a Realm Role to a user in Keycloak</div>
</div>
</li>
<li>
<p>Select the <strong>Role Mappings</strong> tab (1), select the Role you want to assign (2) and then click the <strong>Add selected</strong> button (3):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_4.png" alt="keycloak role 4">
</div>
<div class="title">Figure 27. adding a Realm Role to a user in Keycloak</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_client-roles">Client Roles</h4>
<div class="paragraph">
<p>Client roles are basically a namespace dedicated to a client. Each client gets its own namespace. Client roles are managed under the Roles tab under each individual client:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_5.png" alt="keycloak role 5">
</div>
<div class="title">Figure 28. Creating a Client Role in Keycloak</div>
</div>
<div class="paragraph">
<p>Input a role name and click the <strong>Save</strong> button:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_6.png" alt="keycloak role 6">
</div>
<div class="title">Figure 29. Creating a Client Role in Keycloak</div>
</div>
<div class="paragraph">
<p>For adding the Client Role to an user:</p>
</div>
<div class="paragraph">
<p>Navigate to the <strong>Users</strong> section (1) and select the correct user to asign the role, select the <strong>Role Mappings</strong> tab (2), in the <strong>Client Roles</strong> section select the Client (3), select the desired Role to assign (4) and click the <strong>Add selected</strong> button (5)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_7.png" alt="keycloak role 7">
</div>
<div class="title">Figure 30. adding a Client Role to a user in Keycloak</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_hardcoded-audience">Hardcoded audience</h3>
<div class="paragraph">
<p>When your service relies on realm roles or does not rely on the token&#8217;s roles at all, a hardcoded audience can be useful.
A hardcoded audience is a protocol mapper that adds the client ID of the specified service client to the token as an audience.
If you want to use a different audience than the client ID, you can use any custom value, such as a URL.</p>
</div>
<div class="paragraph">
<p>The protocol mapper can be added directly to the frontend client.
When the protocol mapper is directly added, the audience is always added as well.</p>
</div>
<div class="paragraph">
<p>For better control over the protocol mapper, you can create the protocol mapper on the dedicated client scope:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <strong>Client Scopes</strong> section in the left-side bar.</p>
</li>
<li>
<p>Enter the name for the client scope.</p>
</li>
<li>
<p>Click the <strong>Save</strong> button.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_client_scope_1.png" alt="keycloak client scope 1">
</div>
<div class="title">Figure 31. adding a Client Scope in Keycloak</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For create the mapper itself follow the nexts steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the Mappers tab.</p>
</li>
<li>
<p>Click the Create button.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_client_scope_2.png" alt="keycloak client scope 2">
</div>
<div class="title">Figure 32. adding a mapper to a Client Scope in Keycloak</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the next screen configure the Mapper as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the name of the mapper.</p>
</li>
<li>
<p>In the Mapper type select <code>Audience</code></p>
</li>
<li>
<p>Click the <strong>Save</strong> button.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_client_scope_3.png" alt="keycloak client scope 3">
</div>
<div class="title">Figure 33. adding a mapper to a Client Scope in Keycloak</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_keycloak-sample">Keycloak Sample</h3>
<div class="paragraph">
<p>This template allows you to understand the <strong>authentication</strong> and <strong>authorization</strong> process using Keycloak:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong>: Is the process of confirming that someone or something is who they claim to be.
To secure access to an application or its data, most technology systems employ some form of authentication.
When you need to access an online site or service, for example, you usually have to enter your username and password.
Then, in the background, it compares the username and password you entered to a record in its database.
If the information you provided matches, the system considers you a valid user and grants you access.</p>
</li>
<li>
<p><strong>Authorization</strong>: Is the security process that determines a user or service&#8217;s level of access. In technology, we use authorization to give users or services permission to access some data or perform a particular action. Authentication verifies the user (Lucia) before allowing them access, and authorization determines what they can do once the system has granted them access (view sales information, for example).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the <code>Download</code> section you will find a sample that you can use as a template for integrating Keycloak in your application.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please download the template so you can follow the guide successfully.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The template shows an example of a School with two types of entities, <code>Student</code> and <code>Teacher</code>, the teachers also have the Administrator role, that allows to access to their <code>Student list</code>.</p>
</div>
<div class="paragraph">
<p>In the application you will be able to authenticate yourself through a username and password, and this will give you an authorization token that will allow you to use the application with a certain role.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_keycloak-setup">Keycloak Setup</h4>
<div class="paragraph">
<p>To setup the keycloak server we provide the <code>realm_export.json</code> file that is the configuration of the server that we need to use the template.</p>
</div>
<div class="paragraph">
<p>For import the Realm follow the steps below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_import_realm.png" alt="keycloak import realm"></span></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_import_realm_2.png" alt="keycloak import realm 2">
</div>
<div class="title">Figure 34. Import a realm in keycloak</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new Realm (1)</p>
</li>
<li>
<p>Click in the <strong>Select file</strong> button and choose the <code>realm_export.json</code> file (2)</p>
</li>
<li>
<p>Enter a name for your Realm and click the <strong>Create</strong> button.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The next step is to create users in your realm for that follow the next steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Users</strong> section (1) in the left-side bar, then the <strong>Add user</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_5.png" alt="keycloak user 5">
</div>
<div class="title">Figure 35. Add a user in Keycloak</div>
</div>
</li>
<li>
<p>Complete the fields (1) and click the <strong>Save</strong> button (2):</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_6.png" alt="keycloak user 6">
</div>
<div class="title">Figure 36. Add a user in Keycloak</div>
</div>
</li>
<li>
<p>Set a password for the user:</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_7.png" alt="keycloak user 7">
</div>
<div class="title">Figure 37. Set credentials to a user in Keycloak</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Navigate to the <strong>Credentials</strong> tab (1).</p>
</li>
<li>
<p>Enter a password (2).</p>
</li>
<li>
<p>Confirm the password (3).</p>
</li>
<li>
<p>(<strong>Optional</strong>)
Change the switch to on if you want the user to change their password after the first login (4).</p>
</li>
<li>
<p>Click the <strong>Set Password</strong> button to confirm the changes (5).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For this example, we created two user types,<code>student</code> and <code>teacher</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_user_8.png" alt="keycloak user 8">
</div>
<div class="title">Figure 38. Users for the template</div>
</div>
<div class="paragraph">
<p>Now we are going to assign to the user teacher, the <code>Administrator</code> Role, for that follow the nexts steps:</p>
</div>
<div class="paragraph">
<p>Navigate to the <strong>Users</strong> section (1) and select the correct user to asign the role, select the <strong>Role Mappings</strong> tab (2), in the <strong>Client Roles</strong> section select the <code>SchoolApplication</code> Client (3), select the Administrator Role (4) and click the <strong>Add selected</strong> button (5)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_role_7.png" alt="keycloak role 7">
</div>
<div class="title">Figure 39. adding a Client Role to a user in Keycloak</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you need more information about how to configure the Keycloak server please refer to the <code>How to: Configure Keycloak server</code> section.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_devon4net.application.keycloak">Devon4net.Application.Keycloak</h4>
<div class="paragraph">
<p>This is the startup project of the template. Its main purpose is to launch the api and configure it using the settings files. The following figure shows the directory tree of the application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_application_directory.png" alt="keycloak application directory">
</div>
<div class="title">Figure 40. Devon4net.Application.Keycloak Directory tree</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Controllers</strong>: This template, has two controllers: the <code>KeycloakController</code> for obtaining the access token and the <code>SchoolController</code> for testing that token and the user roles.</p>
</li>
<li>
<p><strong>Model</strong>: The model objects of the application. This template is about a School so we have Persons that are also Students or Teachers. The Teachers will have the <code>Administrator</code> role aswell.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h5>
<div class="paragraph">
<p>The configuration is done in the <code>appsettings.json</code> file. It can contain subversions following the structure <code>appsettings.{environment}.json</code>. For the keycloak sample, the configuration is done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "Keycloak": {
    "Realm": "MyRealm",
    "Url": "http://localhost:8080/",
    "ClientId": "SchoolApplication",
    "GrantType": "password"
  }
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Realm</code>: Your Keycloak realm&#8217;s name.</p>
</li>
<li>
<p><code>Url</code>: The direction of your Keycloak server.</p>
</li>
<li>
<p><code>ClientId</code>: The Id of the Client that you created in the Keykloak server administrator console.</p>
</li>
<li>
<p><code>GrantType</code>: The grant type used to obtain the token.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="devonfw-guide_devon4net.wiki_howto.asciidoc_controllers">Controllers</h5>
<div class="sect5">
<h6 id="devonfw-guide_devon4net.wiki_howto.asciidoc_keycloakcontroller"><code>KeycloakController</code></h6>
<div class="paragraph">
<p>It only has one method with the <code>AllowAnonymous</code> annotation, that means that this method doesn&#8217;t need authorization.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">        [HttpGet]
        [AllowAnonymous]
        public async Task&lt;ActionResult&gt; Login(string username, string password)
        {
            return Ok(await _keycloakService.GetToken(username, password).ConfigureAwait(false));
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Login</code> method calls the Keycloak Service to retrieve the token, it has two parameters, the username and the password.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_access_token.png" alt="keycloak access token">
</div>
<div class="title">Figure 41. Keycloak Controller</div>
</div>
</div>
<div class="sect5">
<h6 id="devonfw-guide_devon4net.wiki_howto.asciidoc_schoolcontroller"><code>SchoolController</code></h6>
<div class="paragraph">
<p>Once we have the access token we can use the methods of this controller, for that we have to authorize ourselves:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_authorize_1.png" alt="keycloak authorize 1"></span></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_authorize_2.png" alt="keycloak authorize 2">
</div>
<div class="title">Figure 42. Authorization with the access token</div>
</div>
<div class="paragraph">
<p>There are two methods available for this controller:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GetStudentSubjects()</code>: For this method, the user should be authorized; either students or teachers can use it.</p>
</li>
<li>
<p><code>GetTeacherStudents()</code>: This method access is restricted to teachers only, as indicated by the following policy:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[Authorize(AuthenticationSchemes = JwtBearerDefaults.AuthenticationScheme, Policy = "SchoolPolicy")]</code></pre>
</div>
</div>
<div class="paragraph">
<p>This policy specifies that only teachers with the <code>Administrator</code> role are permitted to use this method.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_devon4net.application.keycloak.implementation">Devon4Net.Application.Keycloak.Implementation</h4>
<div class="paragraph">
<p>This package contains all the implementation classes. You will find the following directory tree:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/keycloak_implementation_tree.png" alt="keycloak implementation tree">
</div>
<div class="title">Figure 43. Package directory tree</div>
</div>
<div class="paragraph">
<p>We have organized the files as if it was a Devon4Net module package:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuration: Contains all the files necesary for configuration. You can use realm-export.json to import the keycloak configuration for this specific example.</p>
<div class="paragraph">
<p>You will find in the KeycloakConfiguration class how you can add the different policies and the authorization and authentication configuration.</p>
</div>
<div class="paragraph">
<p>For example you can use the following code to add a policy that requires the claim user_roles as Administrator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">services.AddAuthorization(options =&gt;
    {
        options.AddPolicy("SchoolPolicy", policy =&gt; policy.RequireClaim("user_roles", "Administrator"));
    });</code></pre>
</div>
</div>
</li>
<li>
<p>Model: Contains the model objects. In this case we only need the token, which is the response of keycloak but we could put here also the user, for example, if we were to retrieve the information from keycloak.</p>
</li>
<li>
<p>Options: This directory contains the model for all the options used to configure.</p>
</li>
<li>
<p>Services: This directory contains all the services. There is only one service, which access keycloak through the end-points available.</p>
<div class="paragraph">
<p>In this example we only need the token, so there is a method accessing the token end-point from keycloak. You can see the end-points available in keycloak in its dashboard.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_downloads">Downloads</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#devonfw-guide/devon4net.wiki_resources/samples/keycloak/Keycloak.zip">Keycloak Sample</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.keycloak.org/getting-started/getting-started-docker">Getting Started (Docker) - Keycloak Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-avoid-cross-site-request-forgery-xsrf-or-csrf-attacks">How to: Avoid cross-site request forgery (XSRF or CSRF) attacks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every time you authenticate into a web app, your browser becomes trusted for an amount of time to that specific site. This way you can use the application without having to authenticate yourself each time you want to do an operation that requires authorization. This is achieved normally by providing authentication tokens that last a determinate amount of time.</p>
</div>
<div class="paragraph">
<p>Your browser includes in each request a token issued by the app at the moment of authentication, the app verifies it and then sends back the response. A cross-site request forgery is a type of attack where a malicious site can use your authentication token to issue requests through your browser.</p>
</div>
<div class="paragraph">
<p>This is done, without you even noticing and it works because browser requests automatically include all session cookies. So if the request is done from another site with all these cookies (including your authentication cookie) it wont be different from you actually doing the request.</p>
</div>
<div class="paragraph">
<p>For example, you enter the site <code>vulnerable-bank.com</code> and forget to log out after doing all of your operations. Now you are surfing the net and enter the site <code>malicious-site.com</code> this site has a hidden script that performs the following request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>POST /transaction HTTP/1.1
Host: vulnerable-bank.com
Content-Type: application/x-www-form-urlencoded
Cookie: SessionID = 1n4j0sd7uohpf13j98nh570923c48u

account={MaliciousAccount}
amount=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>As all the session cookies are included in the request, the site will be allowed to process the transaction without you even noticing.</p>
</div>
<div class="paragraph">
<p>The most common way to prevent this vulnerability is by making use of anti forgery tokens. This token is placed in the headers and is issued with the request. The malicious-site cannot</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>To configure Anti-Forgery protection in a devon4net project, you must set <code>UseXsrf</code> property in <code>devonfw</code> configuration section to true. You will find this section in <code>appsettings.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "devonfw": {
    "UseXsrf": true
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Setting this property to true will allow you to use <a href="https://docs.microsoft.com/es-es/dotnet/api/microsoft.aspnetcore.antiforgery.iantiforgery?view=aspnetcore-6.0"><code>IAntiforgery</code></a> interface through the service provider and dependency injection in your project.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_use">Use</h3>
<div class="paragraph">
<p>In the devon4net Web API Templaate you will be able to find an example of controller using this protection. You can inject the <code>IAntiforgery</code> interface in the controller constructor like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">private readonly IAntiforgery _antiForgeryToken;

public AntiForgeryTokenController(IAntiforgery antiForgeryToken)
{
    _antiForgeryToken = antiForgeryToken;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can access its methods to manage this special token. For creating one we can use <code>GetAndStoreTokens(HttpContext httpContext)</code> method available on <code>IAntiforgery</code>, and store it in the cookies as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">var token = _antiForgeryToken.GetAndStoreTokens(HttpContext);
HttpContext.Response.Cookies.Append(CustomMiddlewareHeaderTypeConst.XsrfToken, token.RequestToken);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Visit the documentation about this interface to find more information about <code>IAntiforgery</code> methods.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This will be done through a GET request. Now we can vaklidate this token in a controller thanks to the attribute <code>[ValidateAntiForgeryToken]</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[HttpGet]
[Route("/v1/antiforgeryToken/hellosecured")]
[ValidateAntiForgeryToken]
public ActionResult HelloSecured()
{
    return Ok("You have reached a secured AntiForgeryToken method!");
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_testing">Testing</h3>
<div class="paragraph">
<p>We will be using <a href="https://www.postman.com/">Postman</a> to test the use of the controller, as you can see in the next figure, if we try to access the end-point protected by the antiforgery token validation we get an error:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/anti_forgery_hellosecure_error.png" alt="anti forgery hellosecure error">
</div>
<div class="title">Figure 44. HelloSecured end-point error</div>
</div>
<div class="paragraph">
<p>That is beacuse no valid token in <code>XSRF-TOKEN</code> header is specified. Lets access the end-point we created to provide an XSRF token:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/anti_forgery_token.png" alt="anti forgery token">
</div>
<div class="title">Figure 45. Get XSRF token end-point</div>
</div>
<div class="paragraph">
<p>Now that we have the token we can specify it in the request header as shown in the next figure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/anti_forgery_hellosecure_xsrf.png" alt="anti forgery hellosecure xsrf">
</div>
<div class="title">Figure 46. HelloSecured end-point access</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p>Here are some interesting references to continue learning about this topic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://owasp.org/www-community/attacks/csrf">Cross Site Request Forgery (CSRF) - Owasp</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">Cross Site Request Forgery Prevention Cheat Sheet - Owasp</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/aspnet/core/security/anti-request-forgery?view=aspnetcore-6.0">Prevent Cross-Site Request Forgery (XSRF/CSRF) attacks in ASP.NET Core - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/es-es/dotnet/api/microsoft.aspnetcore.antiforgery.iantiforgery?view=aspnetcore-6.0">IAntiforgery Interface - Microsoft Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-import-a-database">How to: Import a database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document you will learn how to easily import a database to your devon4net project or any .Net project. This process is known by a variety of different names: scaffolding, database first, reverse engineering&#8230;&#8203; But they all refer to the process of creating entity models and/or database context automatically based on a database schema.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>You can import a database in your favourite type of schema, but for this example we will be using SQL Server and Visual Studio 2022.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Ensure that you have a connection ready to your database and a correct installation of Visual Studio 2022.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For this example we used <a href="https://docs.microsoft.com/es-es/sql/ssms/download-sql-server-management-studio-ssms?view=sql-server-ver15">Microsoft SQL Server Management Studio</a> to create our database and provide us with a local database connection.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_nuget-packages-installation">NuGet packages installation</h3>
<div class="paragraph">
<p>Before starting with the scaffolding you will need to install the following NuGet packages in your destination project.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_open-the-package-manager-console">Open the Package Manager Console</h4>
<div class="paragraph">
<p>To open the Package Manager Console, follow the next menu steps: <code>View &gt; Other Windows &gt; Package Manager Console</code> and then ensure that the default project in the console is set to the destination project as shown in the next figure.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If the destination project is not the same as the startup project, you may need to install some of the packages in the startup project too. The package manager console will warn you of that if it is necessary.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/pacakge_manager_console.png" alt="pacakge manager console">
</div>
<div class="title">Figure 47. Package Manager Console default project</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_install-the-packages">Install the packages</h4>
<div class="ulist">
<ul>
<li>
<p>Microsoft.EntityFrameworkCore.Tools</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Microsoft.EntityFrameworkCore.Tools</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Microsoft.EntityFrameworkCore.Design</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Microsoft.EntityFrameworkCore.Design</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>MIcrosoft.EntityFrameworkCore.SqlServer</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
As we mentioned we will be using a SQL Server schema, we are installing the database provider for it. Please choose your own <a href="https://docs.microsoft.com/en-us/ef/core/providers/?tabs=dotnet-core-cli">Database Provider</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">install-package Microsoft.EntityFrameworkCore.SqlServer</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_scaffolding-command">Scaffolding command</h3>
<div class="paragraph">
<p>Run the following command to execute the scaffolding operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">scaffold-dbcontext 'Server=(localdb)\mssqllocaldb;Database=DevonDatabase;' Microsoft.EntityFrameworkCore.SqlServer -Tables School,Teacher -ContextDir Domain\Database -OutputDir Domain\Entities</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Your connection string and database provider may be different.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>The first argument is the connection string.</p>
</li>
<li>
<p>The second argument is the Database Provider package for the used schema.</p>
</li>
<li>
<p><code>-Tables {Table list separated by comma}</code> is the list of the tables you want to scaffold.</p>
</li>
<li>
<p><code>-ContextDir</code> will specify the relative path for the context.</p>
</li>
<li>
<p><code>-OutputDir</code> will specify the relative path for the models.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our case, before doing the scaffolding we had something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/before_scaffolding.png" alt="before scaffolding">
</div>
<div class="title">Figure 48. Directory tree before scaffolding</div>
</div>
<div class="paragraph">
<p>And the scaffolding produced the following directory tree:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/after_scaffolding.png" alt="after scaffolding">
</div>
<div class="title">Figure 49. Directory tree after scaffolding</div>
</div>
<div class="paragraph">
<p>If you do not specify <code>-Tables</code>, <code>-ContextDir</code> and <code>-OutputDir</code> all of the tables will be scaffolded and the default directories will be the project directory.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_add-the-context-for-dependency-injection">Add the context for Dependency Injection</h3>
<div class="paragraph">
<p>Now that we have our context we will need to add it either in <code>Program.cs</code> or <code>SetupDatabase</code> method in <code>DevonConfiguration</code> class.</p>
</div>
<div class="paragraph">
<p>As we are using Devon, we will need to go to <code>Devon4Net.Application.WebAPI.Implementation.Configuration.DevonConfiguration</code> and add the folowing line in <code>SetupDatabase</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">services.SetupDatabase&lt;DevonDatabaseContext&gt;(configuration,"DevonDatabase", DatabaseType.SqlServer).ConfigureAwait(false);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Parameter</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;DevonDatabaseContext&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database context you want to add</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configuration</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Available <code>IConfiguration</code> instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>"DevonDatabase"</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the connection string defined at <code>ConnectionString</code> section in the <code>appsettings.{environment}.json</code> configuration file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DatabaseType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database schema available in devon (see the following list).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>List of supported databases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SqlServer</p>
</li>
<li>
<p>Sqlite</p>
</li>
<li>
<p>InMemory</p>
</li>
<li>
<p>Cosmos</p>
</li>
<li>
<p>PostgreSQL</p>
</li>
<li>
<p>MySql</p>
</li>
<li>
<p>MariaDb</p>
</li>
<li>
<p>FireBird</p>
</li>
<li>
<p>Oracle</p>
</li>
<li>
<p>MSAccess</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.microsoft.com/en-us/ef/core/managing-schemas/scaffolding?tabs=vs">Reverse Engineering - Microsoft Docs</a></p>
</li>
<li>
<p><a href="https://docs.microsoft.com/en-us/ef/core/providers/?tabs=dotnet-core-cli">Database Providers - Microsoft Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-litedb">How to: Use LiteDb</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part you will learn how to easily start using a LiteDb database in your project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please read the documentation of this component to learn more about how to set it up and use it.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</h3>
<div class="paragraph">
<p>As you will find all the information in the component documentation, we prepared a video using LiteDb in a very short example:</p>
</div>
<div class="videoblock">
<div class="title">How to setup and use LiteDb component</div>
<div class="content">
<video src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/videos/howto_litedb.mp4" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-customize-headers">How to: Customize Headers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>HTTP headers let the client and the server provide additional information with an HTTP request or a response. As this headers provide information about either the client or the server, it can be dangerous if this information lands in the wrong hands.</p>
</div>
<div class="paragraph">
<p>As Owasp explains in great detail, proper HTTP headers can help prevent security vulnerabilities like Cross-Site Scripting, Clickjacking, Information disclosure and more.</p>
</div>
<div class="paragraph">
<p>In devon we take security very seriously, that&#8217;s why we developed a very easy form of customizing HTTP headers. You will be able to do it configuring the headers in the <code>appsettings.{environment}.json</code> file. A middleware will be configured with those options and will modify each HTTP response according to the specified options.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Headers": {
    "AccessControlExposeHeader": "Authorization",
    "StrictTransportSecurityHeader": "",
    "XFrameOptionsHeader": "DENY",
    "XssProtectionHeader": "1;mode=block",
    "XContentTypeOptionsHeader": "nosniff",
    "ContentSecurityPolicyHeader": "",
    "PermittedCrossDomainPoliciesHeader": "",
    "ReferrerPolicyHeader": ""
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following table shows the options that can be configured.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the links provided to learn more about each header and what can be done with it.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Option</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Header</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>AccessControlExposeHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/Access-Control-Expose-Headers"><code>Access-Control-Expose-Headers</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates which headers may be exposed as part of the response by listing their names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>StrictTransportSecurityHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/Strict-Transport-Security"><code>Strict-Transport-Security</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows a website to tell browsers that it should only communicate with HTTPS instead of using HTTP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XFrameOptionsHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/X-Frame-Options"><code>X-Frame-Options</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used to indicate whether a browser should be allowed to render a page in a <code>&lt;frame&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;embed&gt;</code> or <code>&lt;object&gt;</code>, to prevent attacks such as click-jacking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XssProtectionHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/X-XSS-Protection"><code>X-XSS-Protection</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prevents the loading of a page when it detects cross-site attacks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>XContentTypeOptionsHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/X-Content-Type-Options"><code>X-Content-Type-Options</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is a flag used by the server to indicate that the MIME types advertised in the <code>Content-Type</code> headers should not be changed or followed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ContentSecurityPolicyHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/Content-Security-Policy"><code>Content-Security-Policy</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the administrators of a website to control the resources that the User-Agent can upload to a page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PermittedCrossDomainPoliciesHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://owasp.org/www-project-secure-headers/#x-permitted-cross-domain-policies"><code>X-Permitted-Cross-Domain-Policies</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grants a web client ermission to handle data across domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ReferrerPolicyHeader</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://developer.mozilla.org/es/docs/Web/HTTP/Headers/Referrer-Policy"><code>Referrer-Policy</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines which referrer data, among those sent with the <code>Referer</code> header, should be included with the requests made.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If the response header does not have a value or does not appear in the optons, it will not be added to the response headers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">HTTP headers - MDN Web Docs</a></p>
</li>
<li>
<p><a href="https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html">HTTP Security Response Headers Cheat Sheet - Owasp</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-specflow">How to: Specflow</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document you will learn to use Specflow in your projects for defining, managing and automatically execute readable acceptance tests in .NET.</p>
</div>
<div class="paragraph">
<p>SpecFlow is a.NET test automation tool based on the BDD (Behavior-driven development) paradigm. Specflow tests use the Gherking language to write test cases that are then bound to your application code through bindings, allowing you to run the tests using your preferred testing framework.</p>
</div>
<div class="paragraph">
<p>Before going into detail on how to use Specflow and how you can use it to implement your tests, you will need know Gherking syntax. It is used to write tests in a form that can be readed perfectly as a sentence. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="gherkin language-gherkin">Feature: Calculator
  Scenario: Sum two numbers
    Given the first number is 10
    And the second number is  5
    When the two values are added
    Then the result is 15</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, thanks to Gherkin we have written a test for a calculator, which makes sure that when the values <code>10</code> and <code>5</code> are added, the result is <code>15</code>. Because is a natural-language friendly language you can read the test, and understand the statement.</p>
</div>
<div class="paragraph">
<p>The following table shows the keywords used in Gherkin syntax:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 100%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Keyword</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Feature</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides high level description of a software feature that wants to be tested and group related scenarios.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Rule</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Represents one business rule that should be implemented.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Scenario</code> or <code>Example</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of steps that ilustrates a business rule.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Steps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each step starts with <code>Given</code>, <code>When</code>, <code>Then</code>, <code>And</code> or <code>But</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Background</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scenario context run before the <code>Scenario</code> tests but after <code>Before Hooks</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Scenario Outline</code> or <code>Scenario Template</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is used to run the same <code>Scenario</code> multiple times, with different combinations of values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Scenarios</code> or <code>Examples</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Keyword used to define the variables of <code>Scenario Outline</code> in a table.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>""</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>@</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>#</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>|</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tables</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="gherkin language-gherkin"># Test for the calculator
@mytag
Feature: Calculator
  Scenario Outline: Sum two numbers
    Given the first number is &lt;first&gt;
    And the second number is  &lt;second&gt;
    When the two values are added
    Then the result is &lt;result&gt;

    Examples:
    | first | second | result |
    |    10 |   5    |   15   |
    |    20 |   5    |   25   |</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the <a href="https://cucumber.io/docs/gherkin/">Cucumber Documentation</a> or <a href="https://specflow.org/learn/gherkin/">Specflow Documentation</a> to learn more about the keywords used in Gherkin.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_specflow-installation">Specflow Installation</h3>
<div class="paragraph">
<p>To use specflow you will need to add the Specflow extension to your Visual Studio 2022. This way you can use it in any of your projects. For that open visual studio and navigate to <code>Extensions &gt; Manage Extensions</code>.</p>
</div>
<div class="paragraph">
<p>This will open the extension manager, where you will have to search for the 'SpecFlow' extension and hit download:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_extension.png" alt="specflow extension">
</div>
<div class="title">Figure 50. SpecFlow for VS 2022 in Extension Manager</div>
</div>
<div class="paragraph">
<p>Hitting download will schedule the extension installation. At the time when you close VS2022, you will be able to install the extension by clicking <code>Modify</code> in the pop-up window shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_installation.png" alt="specflow installation">
</div>
<div class="title">Figure 51. SpecFlow installation</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-specflow-project">Create specflow project</h3>
<div class="paragraph">
<p>To create a specflow project for testing, first we will need to have something to test. In this example we will test a Calculator class that we created inside a class library project in an empty solution like shown in the following image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_directory_tree.png" alt="specflow directory tree">
</div>
<div class="title">Figure 52. SpecFlowTest solution directory tree</div>
</div>
<div class="paragraph">
<p>Where, the <code>Calculator</code> class implementation is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class Calculator
{
    public int FirstNumber { get; set; }
    public int SecondNumber { get; set; }

    protected int Add()
    {
        return FirstNumber + SecondNumber;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once we have the Calculator ready, we need to create a Specflow project. For that you can <code>Right click on the solution &gt; Add &gt; New Project&#8230;&#8203;</code>. This will open a window where you can search the specflow project as shown in the next image:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/new_specflow_project.png" alt="new specflow project">
</div>
<div class="title">Figure 53. Add new SpecFlow project</div>
</div>
<div class="paragraph">
<p>When creating the project you will be able to choose the .Net version that you are using, the library for the tests and if you want to use FluentAssertions library. For this example we will use the configuration shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/new_specflow_options.png" alt="new specflow options">
</div>
<div class="title">Figure 54. Choose the project options</div>
</div>
<div class="paragraph">
<p>The specflow template comes with a calculator test implemented, this is their example. But we will create the files from scratch so you know how to complete your testing project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_project_structure.png" alt="specflow project structure">
</div>
<div class="title">Figure 55. Initial project structure</div>
</div>
<div class="paragraph">
<p>As you can see also the template comes with a folder structure defined, you can redifine it as you want but this is the recommended one.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-specflow-tests">Create specflow tests</h3>
<div class="paragraph">
<p>To create a new test using specflow, you can add a new item to your project by <code>Right click in any directory on the project &gt; Add &gt; New item&#8230;&#8203;</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/new_specflow_feature.png" alt="new specflow feature">
</div>
<div class="title">Figure 56. Initial project structure</div>
</div>
<div class="paragraph">
<p>You can type specflow in the search bar to look for the items available thanks to the library and select <code>Feature File for Specflow</code>. You can create a test there in Gherkin syntax:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="Gherkin language-Gherkin">Feature: Calculator

A short summary of the feature

@mytag
Scenario: Add two numbers
	Given the first number is 50
	And my favourite number is 70
	When the two numbers are added
	Then the result should be 120</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have your test created you can build the project by navigating to <code>Build &gt; Build Solution</code>. You will see that the test appears in a purple color, this is because it is not mapped to a definition yet. You can automatically create the definition by <code>Right clicking inside the feature file &gt; Define Steps</code>.</p>
</div>
<div class="paragraph">
<p>This will open the following window:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/define_steps.png" alt="define steps">
</div>
<div class="title">Figure 57. Define SpecFlow Steps</div>
</div>
<div class="paragraph">
<p>Once you press <code>Create</code> the test will no longer appear in purple and will be shown in a white color. This is because now they have a definition. You can also do this manually creating a class and marking it with the <code>[Binding]</code> attribute.</p>
</div>
<div class="paragraph">
<p>This class will need to define the test steps such as Gherkin syntax can be transformed into <code>C#</code> code. You can implement this class as follows to test the Calculator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">using SpecflowCalculator;

namespace SpecFlowProject.StepDefinitions
{
    [Binding]
    public class CalculatorStepDefinitions
    {
        private Calculator _calculator;
        private int _result;

        public CalculatorStepDefinitions()
        {
            _calculator = new Calculator();
        }

        [Given(@"the first number is (.*)")]
        public void GivenTheFirstNumberIs(int p0)
        {
            _calculator.FirstNumber = p0;
        }

        [Given(@"my favourite number is (.*)")]
        public void GivenMyFavouriteNumberIs(int p0)
        {
            _calculator.SecondNumber = p0;
        }

        [When(@"the two numbers are added")]
        public void WhenTheTwoNumbersAreAdded()
        {
            _result = _calculator.Add();
        }

        [Then(@"the result should be (.*)")]
        public void ThenTheResultShouldBe(int p0)
        {
            // xUnit assertions
            Assert.Equal(_result, p0);

            // FluentAssertions
            _result.Should().Be(p0);
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now build the solution again to be able to run the tests.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please revise the <a href="https://specflow.org/learn/gherkin/">Specflow Documentation</a> to learn more about feature bindings.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_run-the-tests">Run the tests</h3>
<div class="paragraph">
<p>To run the tests you can navigate to <code>Test &gt; Test Explorer</code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_test_explorer.png" alt="specflow test explorer">
</div>
<div class="title">Figure 58. VS2022 Test Explorer</div>
</div>
<div class="paragraph">
<p>By clicking the green play button you can run the tests and see the results as shown in the image above.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_living-documentation">Living documentation</h3>
<div class="paragraph">
<p>SpecFlow Living Documentation is a set of tools that allows you to share and collaborate on Gherkin Feature Files. It gives you the option to generate and share an <code>html</code> interactive file. You can do this directly for Azure DevOps or using a CLI (Command Line Interface). In this guide you will learn how to do this with the CLI continuing with the Calculator example.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the <a href="https://docs.specflow.org/projects/specflow-livingdoc/en/latest/">Specflow+LivingDoc</a> documentation to learn more.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---install-cli">Step 1 - Install CLI</h4>
<div class="paragraph">
<p>Install the tool by running the following command in your preferred terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet tool install --global SpecFlow.Plus.LivingDoc.CLI</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---navigate-to-the-build-output-directory">Step 2 - Navigate to the build output directory</h4>
<div class="paragraph">
<p>Now we need to navigate to the build directory of the Specflow Project taht contains the tests. In our case we can navigate to this path by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">cd C:\Projects\devon4net\samples\SpecflowTest\SpecFlowProject\bin\Debug\net6.0</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Your path may be different depending on the root directory, the file structure of the solution and the .Net version you are using.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---run-command-to-generate-results">Step 3 - Run command to generate results</h4>
<div class="paragraph">
<p>To generate the file run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">livingdoc test-assembly SpecFlowProject.dll -t TestExecution.json</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---see-html-results">Step 4 - See html results</h4>
<div class="paragraph">
<p>The file generated can be seen with your favorite browser and will look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/specflow_html.png" alt="specflow html">
</div>
<div class="title">Figure 59. Specflow LivingDoc results</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://cucumber.io/docs/gherkin/">Gherkin Syntax - Cucumber Docs</a></p>
</li>
<li>
<p><a href="https://specflow.org/learn/gherkin/">Learn Gherkin - Specflow Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-circuit-breaker-communication-with-certificates">How To: Circuit breaker communication with Certificates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we are going to configure two services communication for using certificates, and Circuit Breaker Pattern.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the component documentation for more information about how to configure <a href="#devonfw-guide_devon4net.wiki_packages.asciidoc">CircuitBreaker</a> in devon4net and other projects
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>We have to setup two services in order to implement Circuit Breaker pattern, in this scenario, we&#8217;re creating a basic application that connects two services that are similar.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_servicea">ServiceA</h4>
<div class="paragraph">
<p>In the <code>appsettings.{development}.json</code> you must use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"CircuitBreaker": {
    "CheckCertificate": false,
    "Endpoints": [
      {
        "Name": "ServiceB",
        "BaseAddress": "https://localhost:5055",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": true,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "Tls12", //Tls, Tls11,Tls12, Tls13, none
        "CompressionSupport": true,
        "AllowAutoRedirect": true
      }
    ]
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As an example, we call the <code>HttpClientHandler</code> in the controller, however it is preferable to do it in the service class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">    [ApiController]
    [Route("[controller]")]
    public class PingController : ControllerBase
    {
        private IHttpClientHandler HttpClientHandler { get; }

        public PingController(IHttpClientHandler httpClientHandler)
        {
            HttpClientHandler = httpClientHandler;
        }

        /// &lt;summary&gt;
        /// Returs Ping!
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpGet]
        [HttpOptions]
        [Route("/v1/ping/")]
        [ProducesResponseType(typeof(string), StatusCodes.Status200OK)]
        [ProducesResponseType(StatusCodes.Status400BadRequest)]
        [ProducesResponseType(StatusCodes.Status401Unauthorized)]
        [ProducesResponseType(StatusCodes.Status403Forbidden)]
        [ProducesResponseType(StatusCodes.Status500InternalServerError)]
        public IActionResult Ping()
        {
            return Ok("Ping!");
        }

        /// &lt;summary&gt;
        /// Returs Ping!
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpGet]
        [HttpOptions]
        [Route("/v1/remoteping/")]
        [ProducesResponseType(typeof(string), StatusCodes.Status200OK)]
        [ProducesResponseType(StatusCodes.Status400BadRequest)]
        [ProducesResponseType(StatusCodes.Status401Unauthorized)]
        [ProducesResponseType(StatusCodes.Status403Forbidden)]
        [ProducesResponseType(StatusCodes.Status500InternalServerError)]
        public async Task&lt;IActionResult&gt; RemotePing()
        {
            var result = await HttpClientHandler.Send&lt;string&gt;(HttpMethod.Get, "ServiceB", "/v1/pong", null, MediaType.ApplicationJson);
            return Ok(result);
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the code above, we inject the <code>HttpClientHandler</code>, and on the RemotePing() function, we use the HttpClientHandler&#8217;s Send method to communicate ServiceA with ServiceB.</p>
</div>
<div class="paragraph">
<p>The CircuitBreaker setup method must be added to Program.cs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupCircuitBreaker(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also, remember to install the certificate and add the folder containing the certificate to the project.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_serviceb">ServiceB</h4>
<div class="paragraph">
<p>ServiceB is implemented in the same way as ServiceA. You only have to change the name of the service and the base address in the <code>appsettings.{environment}.json</code>, and in the controller method you must change the service name and the endpoint:</p>
</div>
<div class="paragraph">
<p><strong><code>appsettings.Development.json</code></strong> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json"> "CircuitBreaker": {
    "CheckCertificate": false,
    "Endpoints": [
      {
        "Name": "ServicioA",
        "BaseAddress": "https://localhost:9091",
        "Headers": {
        },
        "WaitAndRetrySeconds": [
          0.0001,
          0.0005,
          0.001
        ],
        "DurationOfBreak": 0.0005,
        "UseCertificate": true,
        "Certificate": "localhost.pfx",
        "CertificatePassword": "localhost",
        "SslProtocol": "Tls12", //Tls, Tls11,Tls12, Tls13, none
        "CompressionSupport": true,
        "AllowAutoRedirect": true
      }
    ]
  }</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>PongController</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async Task&lt;IActionResult&gt; RemotePong()
  {
    var result = await HttpClientHandler.Send&lt;string&gt;(HttpMethod.Get, "ServicioA", "/v1/ping", null, MediaType.ApplicationJson);
    return Ok(result);
  }</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_video">Video</h3>
<div class="paragraph">
<p>The preceding example is covered in detail in this video lesson:</p>
</div>
<div class="videoblock">
<div class="title">How to setup Circuit Breaker with certificates</div>
<div class="content">
<video src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/videos/howto_circuitbreaker_certificates.mp4" controls>
Your browser does not support the video tag.
</video>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-rabbitmq">How to: RabbitMQ</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configure-the-server">Configure the Server</h3>
<div class="paragraph">
<p>There are several methods to configure the RabbitMQ server, depending on your operating system.</p>
</div>
<div class="paragraph">
<p>In this tutorial, we will show you how to run a server via Docker, for testing purposes. If you want further information on how to configure and install the RabbitMQ server in a specific operating system, please consult the <a href="https://www.rabbitmq.com/download.html">official RabbitMQ documentation</a></p>
</div>
<div class="paragraph">
<p>First you must have docker installed on your machine. Run the following command to start the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">docker run -it --rm --name rabbitmq -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=password -p 5672:5672 -p 15672:15672 rabbitmq:3.9-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command shows several options parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-it</code>: To create an interactive container</p>
</li>
<li>
<p><code>--rm</code>: To automatically clean up the container and remove the file system when the container exits.</p>
</li>
<li>
<p><code>--name</code>: The name of the container</p>
</li>
<li>
<p><code>-e</code>: Environment variables</p>
</li>
<li>
<p><code>-p</code>: To expose a container&#8217;s internal port</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The server will listen on port 5672, and you may access the management plugin at the following url:</p>
</div>
<div class="paragraph">
<p><a href="http://localhost:15672/" class="bare">http://localhost:15672/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/rabbit-management.png" alt="rabbit management">
</div>
<div class="title">Figure 60. RabbitMQ Management Plugin</div>
</div>
<div class="paragraph">
<p>You may customize your Docker container as you like, please see the <a href="https://registry.hub.docker.com/_/rabbitmq/">official Docker  image documentation</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configure-the-client">Configure the Client</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install the package in your solution using the Package Manager Console:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package Devon4Net.Infrastructure.RabbitMQ</code></pre>
</div>
</div>
</li>
<li>
<p>Create a Configuration static class in order to add the <code>RabbitMqHandler</code> services, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#"> public static class Configuration
    {

        public static void SetupDependencyInjection(this IServiceCollection services, IConfiguration configuration)
        {

            var rabbitMq = serviceProvider.GetService&lt;IOptions&lt;RabbitMqOptions&gt;&gt;();

            if (rabbitMq?.Value != null &amp;&amp; rabbitMq.Value.EnableRabbitMq)
            {
                SetupRabbitHandlers(services);
            }
        }

        private static void SetupRabbitHandlers(IServiceCollection services)
        {
            services.AddRabbitMqHandler&lt;TodoRabbitMqHandler&gt;(true);
        }
    }</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following lines in the <code>Program.cs</code> class:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupRabbitMq(builder.Configuration);
builder.Services.SetupDependencyInjection(builder.Configuration);</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the component in the file <code>appsettings.{environment}.json</code>, for example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">  "RabbitMq": {
    "EnableRabbitMq": true,
    "Hosts": [
      {
        "Host": "127.0.0.1",
        "Port": 5672,
        "Ssl": false,
        "SslServerName": "localhost",
        "SslCertPath": "localhost.pfx",
        "SslCertPassPhrase": "localhost",
        "SslPolicyErrors": "RemoteCertificateNotAvailable" //None, RemoteCertificateNotAvailable, RemoteCertificateNameMismatch, RemoteCertificateChainErrors
      }
    ],

    "VirtualHost": "/",
    "UserName": "admin",
    "Password": "password",
    "Product": "devon4net",
    "RequestedHeartbeat": 10, //Set to zero for no heartbeat
    "PrefetchCount": 50,
    "PublisherConfirms": false,
    "PersistentMessages": true,
    "Platform": "localhost",
    "Timeout": 10,
    "Backup": {
      "UseLocalBackup": true,
      "DatabaseName": "devon4netMessageBackup.db"
    }
  },</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>EnableRabbitMq</code>: True for enabling the RabbitMQ component</p>
</li>
<li>
<p><code>Hosts</code>: Host configuration, which might be a list of multiple hosts</p>
</li>
<li>
<p><code>VirtualHost</code>:  Virtual host&#8217;s name</p>
</li>
<li>
<p><code>UserName</code>: User&#8217;s name</p>
</li>
<li>
<p><code>Password</code>: password for connecting</p>
</li>
<li>
<p><code>RequestedHeartbeat</code>: The heartbeat timeout setting specifies how long the peer TCP connection should be considered unreachable by RabbitMQ and client libraries. Should be set to zero for no heartbeat.</p>
</li>
<li>
<p><code>PrefetchCount</code>:  The amount of messages transmitted by RabbitMQ before EasyNetQ sends a response.</p>
</li>
<li>
<p><code>PublisherConfirms</code>: True for enabling Publisher confirms that simply speaking is an AMQP extension that sends a callback when your message is successfully received by the broker.</p>
</li>
<li>
<p><code>PersistentMessages</code>: When set to true, RabbitMQ will retain messages to disk and survive server restarts. When set to false, performance increases might be expected.</p>
</li>
<li>
<p><code>Platform</code>: The value given here will be shown in the RabbitMQ management interface.</p>
</li>
<li>
<p><code>TimeOut</code>: Range from 0 to 65535. Format is in seconds. For infinite timeout please use 0. Throws System.TimeoutException when value exceeded.</p>
</li>
<li>
<p><code>Backup</code>: Configuration of Message&#8217;s BackUp. Its default database is LiteDB.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Check the <a href="#devonfw-guide_devon4net.wiki_packages.asciidoc">RabbitMQ Component section</a> for examples of the component&#8217;s implementation and essential classes.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.rabbitmq.com/documentation.html">RabbitMQ Documentation</a></p>
</li>
<li>
<p><a href="https://docs.docker.com/engine/reference/run/">Docker docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-kafka">How to: Kafka</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document you will learn how to use kafka component and create and use Producers and Consumers for your application. You will also learn to use the different Handlers available in the <code>Devon4Net.Infrastructure.Kafka</code> component and how to configure them.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_previous-steps">Previous steps</h3>
<div class="paragraph">
<p>To use Kafka you need to have an active Kafka server. There are multple ways to use a kafka server, we are using a docker image but you can choose any desired form.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
We recommend you to go through <a href="https://kafka.apache.org/">Kafka Documentation</a> to learn how to get started with Apache Kafka.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have an Apache Kafka Server up and running you will need to create a project using the <code>Devon4Net</code> template or add <code>Devon4Net.Infrastructure.Kafka</code> NuGet package reference to your project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
You can learn how to set up the component in your project by reading the component documentation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configuration">Configuration</h3>
<div class="paragraph">
<p>When you have both things ready, you can start by adding the following line in your <code>Program.cs</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.SetupKafka(builder.Configuration);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now is the time to configure all the producers and consumers you will be using in the application. You will later be relating this configuration to the Consumer and Producer Handler classes. For that you will need to complete the following configuration in <code>appsettings.{environment}.json</code> file with your preferred parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"Kafka": {
    "EnableKafka": true,
    "Administration": [
      {
        "AdminId": "Admin1",
        "Servers": "127.0.0.1:9092"
      }
    ],
    "Producers": [
      {
        "ProducerId": "Producer1",
        "Servers": "127.0.0.1:9092",
        "ClientId": "client1",
        "Topic": "devonfw",
        "MessageMaxBytes": 1000000,
        "CompressionLevel": -1,
        "CompressionType": "None",
        "ReceiveMessageMaxBytes": 100000000,
        "EnableSslCertificateVerification": false,
        "CancellationDelayMaxMs": 100,
        "Ack": "None",
        "Debug": "",
        "BrokerAddressTtl": 1000,
        "BatchNumMessages": 1000000,
        "EnableIdempotence": false,
        "MaxInFlight": 5,
        "MessageSendMaxRetries": 5,
        "BatchSize": 100000000
      }
    ],
    "Consumers": [
      {
        "ConsumerId": "Consumer1",
        "Servers": "127.0.0.1:9092",
        "GroupId": "group1",
        "Topics": "devonfw",
        "AutoCommit": true,
        "StatisticsIntervalMs": 0,
        "SessionTimeoutMs": 10000,
        "AutoOffsetReset": "Largest",
        "EnablePartitionEof": true,
        "IsolationLevel": "ReadCommitted",
        "EnableSslCertificateVerification": false,
        "Debug": ""
      }
    ]
  }</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please refer to the component documentation to learn more about the configuration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_producer">Producer</h3>
<div class="paragraph">
<p>After defining the configuration in the <code>appsettings.{environment}.json</code> now you can create your handlers extending the ones available in the Kafka component.</p>
</div>
<div class="paragraph">
<p>For the producer you can do something as the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class MessageProducerHandler : KafkaProducerHandler&lt;string,string&gt;
{
    public MessageProducerHandler(IServiceCollection services, IKakfkaHandler kafkaHandler, string producerId) : base(services, kafkaHandler, producerId)
    {
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need to add this handler to your dependencies. For that you can use the following method, and include the <code>Id</code> of the configuration as a parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.AddKafkaProducer&lt;MessageProducerHandler&gt;("Producer1");</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use the handler in any constructor via dependency injection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class KafkaController : ControllerBase
{
    private MessageProducerHandler MessageProducer { get; }

    public KafkaController(MessageProducerHandler messageProducer)
    {
        MessageProducer = messageProducer;
    }

    [HttpPost]
    [AllowAnonymous]
    [ProducesResponseType(typeof(DeliveryResult&lt;string,string&gt;), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [ProducesResponseType(StatusCodes.Status500InternalServerError)]
    [Route("/v1/kafka/deliver")]
    public async Task&lt;IActionResult&gt; DeliverMessage(string key, string value)
    {
        Devon4NetLogger.Debug("Executing DeliverMessage from controller KafkaController");
        var result = await MessageProducer.SendMessage(key, value).ConfigureAwait(false);
        return Ok(result);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, in the previous piece of code, you can see how we are delivering a message to the Kafka server using a POST method in our API. This is done thanks to the <code>SendMessage</code> method.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_consumer">Consumer</h3>
<div class="paragraph">
<p>The consumer is a little different, as you can see in the following piece of code, you will need to override the <code>HandleCommand</code> method. This will handle the process of consuming new messages to which the consumer is subscribed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class MessageConsumerHandler : KafkaConsumerHandler&lt;string, string&gt;
{
    public MessageConsumerHandler(IServiceCollection services, IKakfkaHandler kafkaHandler, string consumerId, bool commit = false, int commitPeriod = 5) : base(services, kafkaHandler, consumerId, commit, commitPeriod)
    {
    }

    public override void HandleCommand(string key, string value)
    {
        Devon4NetLogger.Information($"Consumed message key: {key} | value: {value}");
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similar to the producer, the Consumer also needs to be related to a configuration via the <code>Id</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">builder.Services.AddKafkaConsumer&lt;MessageConsumerHandler&gt;("Consumer1");</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-nexus">How to: Use Nexus</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section we will show a practical example of how to create a raw hosted repository, to which a file will be uploaded and then retrieved and downloaded.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create new Raw Hosted Repository:</p>
<div class="paragraph">
<p>To create a new repository of this type, we must first create a new instance of the <code>RawHostedRepository</code> class. This class will be created with its pertinent attributes. The following code snippet shows the example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">var rawHostedRepository new RawHostedRepository
    {
        Name = "SampleRepository",
        Online = true,
        Storage = CreateDefaultStorage(),
        Raw = new Raw
        {
            ContentDisposition = "ATTACHMENT"
        }
    };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this object is created, a call to the nexus handler will be performed, specifically the <code>Task CreateRepository&lt;T&gt;(T repositoryDto)</code> method. The example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">await _nexusHandler.CreateRepository(rawHostedRepository).ConfigureAwait(false);</code></pre>
</div>
</div>
</li>
<li>
<p>Upload new component:</p>
<div class="paragraph">
<p>To create a component
similarly to the previous step, in order to upload a new repository, an instance of the type of component to be uploaded must be created, in this case it will be of type raw. The class to be created will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">var rawComponent = new RawUploadComponent()
    {
        RepositoryName = "SampleRepository",
        Filename = {file path},
        Directory = "SampleDirectory",
        AssetPath = SampleAssetPath,
    };</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once this object is created, a call to the nexus handler will be performed, specifically the <code>Task UploadComponent&lt;T&gt;(T uploadComponent)</code> method. The example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">await _nexusHandler.UploadComponent(rawComponent);</code></pre>
</div>
</div>
</li>
<li>
<p>Retrieve metadata from component</p>
<div class="paragraph">
<p>To retrieve the component metadata, the <code>Task&lt;Component&gt; GetComponent(string repositoryName, string componentName)</code> method of the nexus handler will be used. The example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">var component = await _nexusHandler.GetComponent("SampleRepository", "SampleDirectory/SampleAssetPath");</code></pre>
</div>
</div>
</li>
<li>
<p>Download uploaded file</p>
<div class="paragraph">
<p>To download the file, the <code>Task&lt;string&gt; DownloadAsset(string repositoryName, string assetName)</code> method of the nexus handler will be used. The example is shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="C# language-C#">var downloadedFile = await _nexusHandler.DownloadAsset("SampleRepository", "SampleDirectory/SampleAssetPath");</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-protocol-buffers">How to: Protocol buffers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Protocol buffers are Google&#8217;s language-neutral, platform-neutral, extensible mechanism for serializing structured data. You can see it as a JSON or a XML file, but smaller, faster and with an easier syntax.</p>
</div>
<div class="paragraph">
<p>Protocol buffers are ideal for any situation in which you need to serialize data in a neutral language. Very useful when defining communications such as gRPC protocol.</p>
</div>
<div class="paragraph">
<p>In this guide you will learn how to create a protocol buffer using <code>proto3</code> language.</p>
</div>
<div class="paragraph">
<p>The <code>.proto</code> file starts with a package declaration, which helps to prevent naming conflicts between different projects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto3 language-proto3">syntax = "proto3";

option csharp_namespace = "Devon4Net.Application.GrpcClient.Protos";

package greet;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also for C#, you can specify the <code>csharp_namespace</code> option. If it wasn&#8217;t specified, the generated classes would be placed in a namespace matching the package name.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_messages">Messages</h3>
<div class="paragraph">
<p>You also have message definitions, which is an aggregate containing a set of typed fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto3 language-proto3">message Person {
  string name = 1;
  int32 id = 2;
  string email = 3;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example defines a type Person with <code>name</code>, <code>id</code> and <code>email</code>. Each field needs a unique identifier, which is the number shown after the <code>=</code>. The data types are the standard ones including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say that this Person can have many phone numbers, we could do something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto3 language-proto3">message Person {
  string name = 1;
  int32 id = 2;
  string email = 3;
  repeated PhoneNumber phoneNumbers = 4;
}

message PhoneNumber {
  string number = 1;
  PhoneType type = 2;
}

enum PhoneType {
  MOBILE = 0;
  HOME = 1;
  WORK = 2;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, if a field is <code>repeated</code>, the field may be repeated any number of times, including 0. You can also define <code>enum</code> types if you want one of your fields to have one of a predefined list of values.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_services">Services</h3>
<div class="paragraph">
<p>If you want to use your message types with an RPC system, you may specify an RPC service interface in a.proto file, and the protocol buffer compiler will create code and stubs in your preferred language.</p>
</div>
<div class="paragraph">
<p>For example you could define the following contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto3 language-proto3">service SearchService {
  rpc Search(SearchRequest) returns (SearchResponse);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case we will have a <code>SearchService</code> class with a <code>Search</code> method that accepts a <code>SearchRequest</code> and returns a <code>SearchResponse</code>. Both (SearchRequest and SearchResponse) need to be mapped to a message.</p>
</div>
<div class="paragraph">
<p>The following example shows the complete <code>.proto</code> file used in the devon gRPC templates.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="proto3 language-proto3">syntax = "proto3";

option csharp_namespace = "Devon4Net.Application.GrpcClient.Protos";

package greet;

// The greeting service definition.
service Greeter {
  // Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply);
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings.
message HelloReply {
  string message = 1;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please revise the template documentation and the component documentation to learn more about gRPC
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://developers.google.com/protocol-buffers">Protocol Buffers - Google Docs</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-lambda-function">How to: AWS Lambda Function</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this part of the document you are going to learn how to develop and deploy AWS Lambda functions using devon4net.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
We will make use of the devon4net AWS template. So please make sure you have read its documentation to know where everything is placed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-a-lambda-function">What is a Lambda Function?</h3>
<div class="paragraph">
<p>A Lambda Function is a function or piece of code that runs in AWS without having to configure or manage a server. You can setup your code and deploy it to the AWS Lambda Service and can trigger and be triggered from other AWS Services.</p>
</div>
<div class="paragraph">
<p>It supports numerous programming languages among which is .NET.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_install-the-aws-template-and-visual-studio-aws-tools">Install the AWS template and Visual Studio AWS tools</h3>
<div class="paragraph">
<p>In devon4Net you have some AWS templates available, to install them you can run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet new --install Devon4Net.AWS.Template</code></pre>
</div>
</div>
<div class="paragraph">
<p>After this you will be able to create a project using the template provided by devon4net that include the components you need to start developing your first lambda function.</p>
</div>
<div class="paragraph">
<p>You will also need to install the AWS tools for Visual Studio. Run the following command to install the tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet tool install -g Amazon.Lambda.Tools</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or check if a new version is available in case you have already installed it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet tool update -g Amazon.Lambda.Tools</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-project-using-the-template">Create a project using the template</h3>
<div class="paragraph">
<p>Now that everything is installed you can start by creating your project using the template, for that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Visual Studio 2022 and select create a new project.</p>
</li>
<li>
<p>Look for the devon4net AWS Template, select it and click next.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_1.png" alt="aws template 1">
</div>
<div class="title">Figure 61. Create a new AWS project using devon4net</div>
</div>
</li>
<li>
<p>Choose a name and project location and create it.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_2.png" alt="aws template 2">
</div>
<div class="title">Figure 62. Create a new AWS project using devon4net</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This three steps will create the project where we will develop our function. For this tutorial, we will focus in the Lambda part of the template. That means, that we will only be using the <code>Devon4Net.Application.Lambda</code> project present in the template:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_lambda.png" alt="aws template lambda">
</div>
<div class="title">Figure 63. Devon4Net.Application.Lambda file structure</div>
</div>
<div class="paragraph">
<p>As you can see in the screenshot above, you already have some example functions that are already working:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SnsManagement</code>: Example with Amazon Simple Notification Service (SNS)</p>
</li>
<li>
<p><code>SqsManagement</code>: Example with Amazon Simple Queue Service (SQS)</p>
</li>
<li>
<p><code>StringManagement</code>: Example processing some operations over strings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each directory has the following subdirectories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handlers: Implementation of the functions.</p>
</li>
<li>
<p>Functions: Function definition for the services.</p>
</li>
<li>
<p>Dto: Objects used to input and output the data in the functions.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you want to learn more about what this part of the template includes you can read the Template Documentation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_develop-your-first-function">Develop your first function</h3>
<div class="paragraph">
<p>We will follow the same file structure than the examples that are already in the template. For the example we will create a Calculator that will do a mathematical division of two numbers, <strong>dividend</strong> and <strong>divisor</strong>; and will produce two other numbers, <strong>quotient</strong> and <strong>remainder</strong>.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-input-and-output-class">Step 1 - Create Input and output class</h4>
<div class="paragraph">
<p>As the example says, we will need to input dividend and divisor, and output quotient and remainder, so lets create <code>CalculatorInputDto</code> and <code>CalculatorOutput</code> objects in <code>CalculatorManagement/Dto</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class CalculatorInputDto
{
    public int Dividend { get; set; }
    public int Divisor { get; set; }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class CalculatorOutputDto
{
    public int Quotient { get; set; }
    public int Remainder { get; set; }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-function-handler">Step 2 - Create Function Handler</h4>
<div class="paragraph">
<p>To create the function handler you will need to implement the <code>FunctionHandler</code> method available thanks to <code>ILambdaEventHandler&lt;TInput, TOutput&gt;</code> interface from <code>Devon4Net.Infrastructure.AWS.Lambda</code> component.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
To learn more about it, please read the component documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This method will contain all the logic necessary that will be aplied to <code>TInput</code> to produce <code>TOutput</code>, being <code>CalculatorInputDto</code> and <code>CalculatorOutputDto</code> respectively.</p>
</div>
<div class="paragraph">
<p>To follow the structure it will be placed in <code>CalculatorManagement/Handlers</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class CalculatorFunctionEventHandler : ILambdaEventHandler&lt;CalculatorInputDto, CalculatorOutputDto&gt;
{
    public Task&lt;CalculatorOutputDto&gt; FunctionHandler(CalculatorInputDto calculatorInput, ILambdaContext context)
    {
        CalculatorOutputDto output = new()
        {
            Quotient = calculatorInput.Dividend/calculatorInput.Divisor,
            Remainder = calculatorInput.Dividend%calculatorInput.Divisor
        };
        return Task.FromResult(output);
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---add-function-to-services">Step 3 - Add Function to Services</h4>
<div class="paragraph">
<p>Now we need to create our Function class that will inherit from <code>LambdaFunction&lt;TInput, TOutput&gt;</code> also available thanks to the <code>Devon4Net.Infrastructure.AWS.Lambda</code> component.</p>
</div>
<div class="paragraph">
<p>And we will also need to implement the abstract method <code>ConfigureServices</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class CalculatorFunction : LambdaFunction&lt;CalculatorInputDto, CalculatorOutputDto&gt;
{
    protected override void ConfigureServices(IServiceCollection services)
    {
        services
            .AddTransient&lt;ILambdaEventHandler&lt;CalculatorInputDto, CalculatorOutputDto&gt;, CalculatorFunctionEventHandler&gt;();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It will be placed in <code>CalculatorManagement/Functions</code> to follow the same structure.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---configure-it-in-serverless.template">Step 4 - Configure it in <code>serverless.template</code></h4>
<div class="paragraph">
<p>After the previous three steps we will have something like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_calculator.png" alt="aws template calculator">
</div>
<div class="title">Figure 64. Calculator function file structure</div>
</div>
<div class="paragraph">
<p>Now we need to configure it so that the function is interpreted by AWS Lambda service as a Lambda function. For that we have a template defined as <code>serverless.template</code>.
In that file we will find the configuration for all the functions, where we will need to add the following configuration for the <code>CalculatorManagementFunction</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">"CalculatorManagementFunction": {
  "Type": "AWS::Serverless::Function",
  "Properties": {
    "Handler": "Devon4Net.Application.Lambda::Devon4Net.Application.Lambda.business.CalculatorManagement.Functions.CalculatorFunction::FunctionHandler",
    "Runtime": "dotnetcore6.0",
    "CodeUri": "",
    "MemorySize": 512,
    "Timeout": 30,
    "Role": null,
    "Policies": [
      "AWSLambdaFullAccess",
      "AmazonSSMReadOnlyAccess",
      "AWSLambdaVPCAccessExecutionRole"
    ],
    "Environment": {
      "Variables": {}
    },
    "Events": {
      "ProxyResource": {
        "Type": "Api",
        "Properties": {
          "Path": "/{proxy+}",
          "Method": "ANY"
        }
      },
      "RootResource": {
        "Type": "Api",
        "Properties": {
          "Path": "/",
          "Method": "ANY"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Before trying everything, as we are not using neither AWS Secrets Manager nor AWS Parameter Store, navigate to <code>appsettings.json</code> and make sure the following variables are set to <code>false</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "AWS": {
    "UseSecrets": false,
    "UseParameterStore": false,
    "Credentials": {
      "Profile": "",
      "Region": "eu-west-1",
      "AccessKeyId": "",
      "SecretAccessKey": ""
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---try-it">Step 5 - Try it</h4>
<div class="paragraph">
<p>To try that everything works fine in our local we will be using <strong>Mock Lambda Test Tool 6.0</strong> from the AWS toolkit that we installed earlier.</p>
</div>
<div class="paragraph">
<p>For that, right click in the project (1) and select it as startup project (2). Then execute it by pressing the green button which says <code>Mock Lambda Test Tool 6.0</code> (3).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_execute.png" alt="aws template execute">
</div>
<div class="title">Figure 65. Execute the lambda function</div>
</div>
<div class="paragraph">
<p>Now navigate to <code><a href="http://localhost:5050/" class="bare">http://localhost:5050/</a></code> using your favorite web browser (1) and select the CalculatorFunction in the UI (2). You can put your desired numbers in the form of a JSON in the box (3), press Execute (4) and check the results (5).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_test.png" alt="aws template test">
</div>
<div class="title">Figure 66. Try it</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/lambda/">AWS Lambda</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/sqs/">Amazon Simple Queue Service (SQS)</a></p>
</li>
<li>
<p><a href="https://aws.amazon.com/sns/">Amazon Simple Notification Service (SNS)</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
Please check the next section if you want to learn how to deploy lambda functions.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-deploy-aws-lambda-functions">How to: Deploy AWS Lambda Functions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you are going to learn how to deploy AWS Lambda functions using AWS CLI, AWS console portal (web), and with the visual studio plugin.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you want to know more about developing lambda fuctions, please check the previous section.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_install-amazon-lambda-tools">Install Amazon Lambda Tools</h3>
<div class="paragraph">
<p>You will need to install the AWS Lambda tools. Run the following command to install the tools:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet tool install -g Amazon.Lambda.Tools</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or check if a new version is available in case you have already installed it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet tool update -g Amazon.Lambda.Tools</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Working with AWS lambda fuctions requires an AWS account, remember that this type of operations may incur a cost.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-console-portal-web">Deployment with AWS console portal (web)</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-publish-file">Step 1 - Create publish file</h4>
<div class="paragraph">
<p>Navigate to the application folder, run a terminal and execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet lambda package</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file will be stored in the following path:</p>
</div>
<div class="paragraph">
<p><code>{Your-Project-Path}\bin\Release\{.Net-Version}\publish</code></p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example: :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_lambda_publish.png" alt="aws lambda publish">
</div>
<div class="title">Figure 67. Lambda AWS publish path example</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-the-lambda-fuction-in-the-aws-lambda-dashboard">Step 2 - Create the lambda fuction in the AWS Lambda dashboard</h4>
<div class="paragraph">
<p>To create the lambda fuction visit the <a href="https://eu-west-1.console.aws.amazon.com/lambda/home?region=eu-west-1">AWS lambda Dashboard</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Remember to choose your desired region, service costs may depend on the selected region
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then, in the upper right corner of the dashboard, click the <strong>Create function</strong> button.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda.png" alt="aws create lambda">
</div>
<div class="title">Figure 68. AWS Lambda dashboard</div>
</div>
<div class="paragraph">
<p>In the following page, you must provide a function name (1) and choose the appropriate runtime (2) for your project, which in our case is .Net 6.
Then click in the <strong>Create function</strong> button (3).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_2.png" alt="aws create lambda 2">
</div>
<div class="title">Figure 69. Create function configuration</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---upload-.zip-publish-file">Step 3 - Upload .zip publish file</h4>
<div class="paragraph">
<p>When we have finished creating our function, we must submit the .zip file that we prepared in step 1:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_3.png" alt="aws create lambda 3">
</div>
<div class="title">Figure 70. Function configuration</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---add-the-lambda-handler">Step 4 - Add the Lambda Handler</h4>
<div class="paragraph">
<p>To add the lambda handler, click the <strong>Edit</strong> button in the Runtime settings section of the code tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_4.png" alt="aws create lambda 4">
</div>
<div class="title">Figure 71. AWS Lambda dashboard</div>
</div>
<div class="paragraph">
<p>In the next page, ensure that you have selected the right runtime for your project (1), and then add the Handler (2), which must have the following structure:</p>
</div>
<div class="paragraph">
<p><code>Assembly::Namespace.ClassName::MethodName</code></p>
</div>
<div class="paragraph">
<p>In our example:</p>
</div>
<div class="paragraph">
<p><code>Devon4Net.Application.Lambda::Devon4Net.Application.Lambda.Functions.CalculatorFunction::FunctionHandler</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
The handler&#8217;s name cannot exceed 128 characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then click in the <strong>Save</strong> button(3).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_5.png" alt="aws create lambda 5">
</div>
<div class="title">Figure 72. Edit runtime settings</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---test-it">Step 5 - Test it</h4>
<div class="paragraph">
<p>You may test your lambda function by selecting the <strong>test tab</strong> (1) and providing the function&#8217;s input parameters (2) in .JSON format:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_6.png" alt="aws create lambda 6">
</div>
<div class="title">Figure 73. The AWS Lambda Dashboard&#8217;s Test tab</div>
</div>
<div class="paragraph">
<p>Once the information has been provided, click the <strong>Test</strong> button in the upper right corner of the page (3).</p>
</div>
<div class="paragraph">
<p>The output should look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_7.png" alt="aws create lambda 7">
</div>
<div class="title">Figure 74. Results of AWS Lambda function execution</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-cli">Deployment with AWS CLI</h3>
<div class="paragraph">
<p>For deploying the lambda function using the Amazon Web Services CLI (Command Line Interface) first you will need to install the tool. You can check if you already have it by running the following command in your preferred terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws --version</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you don&#8217;t see any output, please refer to the following guide for <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">Installing or updating the latest version of the AWS CLI</a>.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---configure-your-aws-cli">Step 1 - Configure your AWS CLI</h4>
<div class="paragraph">
<p>Before using the CLI, you will need to configure it so that it can be linked to your aws account. For that, run the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws configure</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need to input some security credentials that you will be able to find in your Security Credentials section in your <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=eu-west-1#/security_credentials">AWS Dashboard</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-role-with-basic-policy">Step 2 - Create Role with basic policy</h4>
<div class="paragraph">
<p>Create the execution role that gives your function permission to access AWS resources.</p>
</div>
<div class="paragraph">
<p>In the following example, <code>trust-policy.json</code> is a file in the current directory. This trust policy allows Lambda to use the role&#8217;s permissions and contains the following data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "Service": "lambda.amazonaws.com"
      },
      "Action": "sts:AssumeRole"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To create an execution role with the AWS CLI and the previous trust policy, use the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws iam create-role --role-name lambda-ex --assume-role-policy-document file://trust-policy.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>To add permissions to the role, use the attach-policy-to-role command. Start by adding the AWSLambdaBasicExecutionRole managed policy, which adds permissions to write logs to CloudWatch Logs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws iam attach-role-policy --role-name lambda-ex --policy-arn arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---create-publish-file">Step 3 - Create publish file</h4>
<div class="paragraph">
<p>Navigate to the application folder, run a terminal and execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet lambda package</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file will be stored in the following path:</p>
</div>
<div class="paragraph">
<p><code>{Your-Project-Path}\bin\Release\{.Net-Version}\publish</code></p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example: :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_lambda_publish.png" alt="aws lambda publish">
</div>
<div class="title">Figure 75. Lambda AWS publish path example</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---deploy-the-function">Step 4 - Deploy the function</h4>
<div class="paragraph">
<p>Open a terminal in the path of your lambda <code>.zip</code> file (result of the previous step). For the next command you will need the following data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>{function-name}</strong>: The name you want for the function. e.g <code>AWSCalculator</code></p>
</li>
<li>
<p><strong>{zip-name}</strong>: The name of the zip that contains the publish files. e.g <code>Devon4Net.Application.Lambda.zip</code></p>
</li>
<li>
<p><strong>{handler}</strong>: The handler route of the lambda function folowing the form <em>Assembly::Namespace.ClassName::MethodName</em>. e.g <code>Devon4Net.Application.Lambda::Devon4Net.Application.Lambda.Functions.CalculatorFunction::FunctionHandler</code></p>
</li>
<li>
<p><strong>{runtime}</strong>: The runtime environment for your function to run on. e.g <code>dotnet6</code></p>
</li>
<li>
<p><strong>{account-id}</strong>: The account id from your <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=eu-west-1#/security_credentials">AWS Dashboard</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To deploy the function run the following command replacing the previous parameters with your data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
The handler&#8217;s name cannot exceed 128 characters.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws lambda create-function --function-name {function-name} --zip-file fileb://{zip-name} --handler {handler} --runtime {runtime} --role arn:aws:iam::{account-id}:role/lambda-ex</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our example, the command will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws lambda create-function --function-name AWSCalculator --zip-file fileb://Devon4Net.Application.Lambda.zip --handler Devon4Net.Application.Lambda::Devon4Net.Application.Lambda.Functions.CalculatorFunction::FunctionHandler --runtime dotnet6 --role arn:aws:iam::123456789012:role/lambda-ex</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see a JSON output with the result of the deployment if everything worked properly. You can also check if the deployment was done correctly by listing your lambda functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws lambda list-functions --max-items 10</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---test-the-function">Step 5 - Test the function</h4>
<div class="paragraph">
<p>To test the function you can run the <code>invoke</code> command that will receive an <code>input.json</code> file containing the input data for the lambda function, and will output the result in <code>output.json</code>. The input file will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
  "Dividend": 22,
  "Divisor": 3
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For our example calculator, run following the command in the same directory than the <code>input.json</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">aws lambda invoke --function-name AWSCalculator --cli-binary-format raw-in-base64-out --payload file://input.json output.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>If everything has gone according to plan, your <code>output.json</code> file will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
    "Quotient":7,
    "Remainder":1
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_deployment-with-aws-toolkit-for-visual-studio">Deployment with AWS Toolkit for Visual Studio</h3>
<div class="paragraph">
<p>For deploying the lambda function using the <strong>AWS Toolkit for Visual Studio</strong> first you will need to install the plugin.</p>
</div>
<div class="paragraph">
<p>For installing it, please refer to the following documentation <a href="https://docs.aws.amazon.com/toolkit-for-visual-studio/latest/user-guide/setup.html#install">Install the AWS Toolkit for Visual Studio</a>.</p>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---set-up-your-aws-account-in-visual-studio">Step 1 - Set up your AWS Account in Visual Studio</h4>
<div class="paragraph">
<p>The first thing that you have to do, is configure your AWS Credentials. For that you must navigate to:</p>
</div>
<div class="paragraph">
<p><strong>View &gt; AWS Explorer</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_9.png" alt="aws create lambda 9">
</div>
<div class="title">Figure 76. Visual Studio AWS toolkit</div>
</div>
<div class="paragraph">
<p>Add a new profile for AWS credentials as showing on the image below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_10.png" alt="aws create lambda 10">
</div>
<div class="title">Figure 77. Visual Studio AWS toolkit</div>
</div>
<div class="paragraph">
<p>Set the credentials needed:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_11.png" alt="aws create lambda 11">
</div>
<div class="title">Figure 78. Visual Studio AWS toolkit</div>
</div>
<div class="paragraph">
<p>You may find the Access Key ID (2) and the Secret Access Key (3) at <a href="https://us-east-1.console.aws.amazon.com/iam/home?region=eu-west-1#/security_credentials">AWS Dashboard</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---create-publish-file">Step 2 - Create publish file</h4>
<div class="paragraph">
<p>Navigate to the application folder, run a terminal and execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet lambda package</code></pre>
</div>
</div>
<div class="paragraph">
<p>The file will be stored in the following path:</p>
</div>
<div class="paragraph">
<p><code>{Your-Project-Path}\bin\Release\{.Net-Version}\publish</code></p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example: :</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_lambda_publish.png" alt="aws lambda publish">
</div>
<div class="title">Figure 79. Lambda AWS publish path example</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---create-a-new-function">Step 3 - Create a new function</h4>
<div class="paragraph">
<p>Return to the AWS Explorer, right click in AWS Lambda (1) and select the Create New Function option (2)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_8.png" alt="aws create lambda 8">
</div>
<div class="title">Figure 80. Visual Studio AWS toolkit</div>
</div>
<div class="paragraph">
<p>In the next screen you must provide the details about the function that you want to upload</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_12.png" alt="aws create lambda 12">
</div>
<div class="title">Figure 81. Visual Studio AWS toolkit</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Source Code: Refers to the .zip file that you created in the previous step</p>
</li>
<li>
<p>Function Name: The name that you want for your function</p>
</li>
<li>
<p>Handler&#8217;s name: This parameter must follow the next structure:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>Assembly::Namespace.ClassName::MethodName</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
The handler&#8217;s name cannot exceed 128 characters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the information has been provided, click the <strong>Next</strong> button.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---create-role-with-basic-policy">Step 4 - Create Role with basic policy</h4>
<div class="paragraph">
<p>In the next step, we&#8217;ll set up a Role.
Choose an existing role or create one if you don&#8217;t have one already.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_13.png" alt="aws create lambda 13">
</div>
</div>
<div class="paragraph">
<p>Then click the <strong>Upload</strong> button.</p>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---test-the-function">Step 5 - Test the function</h4>
<div class="paragraph">
<p>Now you can test your lambda function providing the function&#8217;s input parameters (1) in JSON format:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_create_lambda_14.png" alt="aws create lambda 14">
</div>
<div class="title">Figure 82. Visual Studio AWS toolkit</div>
</div>
<div class="paragraph">
<p>Once the information has been provided, click the <strong>Invoke</strong> button (2) to run the function.</p>
</div>
<div class="paragraph">
<p>You can see the Response (3) and the Log output (4)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://aws.amazon.com/lambda/">AWS Lambda</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html">Lambda runtimes</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html">Using Lambda with the AWS CLI</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/toolkit-for-visual-studio/latest/user-guide/welcome.html">AWS Toolkit for Visual Studio</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-serverless">How to: AWS Serverless</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, you will learn how to launch a AWS WebAPI serverless using devon4net.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
We will make use of the devon4net AWS template. So please make sure you have read its documentation to know where everything is placed.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-a-serverless-architecture">What is a serverless architecture?</h3>
<div class="paragraph">
<p>A serverless architecture is a way to build and run applications and services without having to manage infrastructure. Your application still runs on servers, but all the server management is done by AWS.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_install-the-aws-template-and-visual-studio-aws-tools">Install the AWS template and Visual Studio AWS tools</h3>
<div class="paragraph">
<p>In devon4Net you have some AWS templates available, to install them you can run the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">dotnet new --install Devon4Net.AWS.Template</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following that, you will be able to build a project using the devon4net template that includes the components you need to begin building your first AWS serverless WebAPI.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_create-a-project-using-the-template">Create a project using the template</h3>
<div class="paragraph">
<p>Now that everything is in place, you may begin by creating your project using the template:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open Visual Studio 2022 and select create a new project.</p>
</li>
<li>
<p>Look for the devon4net AWS Template, select it and click next.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_1.png" alt="aws template 1">
</div>
<div class="title">Figure 83. Create a new AWS project using devon4net</div>
</div>
</li>
<li>
<p>Choose a name and project location and create it.</p>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_3.png" alt="aws template 3">
</div>
<div class="title">Figure 84. Create a new AWS project using devon4net</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>These three procedures will result in the creation of the project in which we will develop our serverless WebAPI.
For that, we will just use the project 'Devon4Net.Application.WebAPI.AwsServerless' from the template:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/WebAPI-AwsServerless-structure.png" alt="WebAPI AwsServerless structure">
</div>
<div class="title">Figure 85. Devon4Net.Application.WebAPI.AwsServerless file structure</div>
</div>
<div class="paragraph">
<p>[[devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---configure-it-in-appsettings.{environment}.json]]
==== Step 1 - Configure it in <code>appsettings.{environment}.json</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="json language-json">{
    "AWS": {
    "EnableAws": true,
    "UseSecrets": true,
    "UseParameterStore": true,
    "Credentials": {
      "Profile": "default",
      "Region": "eu-west-1",
      "AccessKeyId": "",
      "SecretAccessKey": ""
    },
    "Cognito": {
      "IdentityPools": [
        {
          "IdentityPoolId": "",
          "IdentityPoolName": "",
          "ClientId": ""
        }
      ]
    },
    "SqSQueueList": [
      {
        "QueueName": "", // Mandatory. Put the name of the queue here
        "Url": "", //optional. If it is not present, it will be requested to AWS
        "UseFifo": false,
        "MaximumMessageSize": 256,
        "NumberOfThreads": 2,
        "DelaySeconds": 0,
        "ReceiveMessageWaitTimeSeconds": 0,
        "MaxNumberOfMessagesToRetrievePerCall": 1,
        "RedrivePolicy": {
          "MaxReceiveCount": 1,
          "RedrivePolicy": {
            "MaxReceiveCount": 1,
            "DeadLetterQueueUrl": ""
          }
        }
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
If you want to learn more about these parameters you can check the template or the component documentation.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---set-up-as-startup-project">Step 2 - Set up as startup project</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Right click in the <code>Devon4Net.Application.WebAPI.AwsServerless</code>.</p>
</li>
<li>
<p>Select the "Set as Startup Project" option.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/aws_template_startup.png" alt="aws template startup">
</div>
<div class="title">Figure 86. Setting a project as Startup project</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---run-it">Step 3 - Run it</h4>
<div class="paragraph">
<p>Run the project and now you can start to develop your serverless WebAPI.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-aws-dynamodb">How to: AWS DynamoDB</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide, you will learn how to configure and use the Amazon DynamoDB database service using devon4net.</p>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-amazon-dynamodb">What is Amazon DynamoDB?</h3>
<div class="paragraph">
<p>Amazon DynamoDB is a fully managed NoSQL database service that provides fast and predictable performance with seamless scalability. In DynamoDB, tables, items, and attributes are the core components that you work with. A table is a collection of items, and each item is a collection of attributes. DynamoDB employs primary keys to uniquely identify each item in a table, as well as secondary indexes to provide query flexibility.
DynamoDB supports two different types of primary keys:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Partition key</strong></p>
</li>
<li>
<p><strong>Partition key and Sort key</strong></p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title=""></i>
</td>
<td class="content">
Sort keys and Secondary indexes are not yet available in devon4net; however, we are working on introducing such features in future updates.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In devon4net you may work with two types of repositories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Table Repository</strong>, which is intended for Complex objects, works with tables and serialization.</p>
</li>
<li>
<p><strong>Entity Repository</strong>, which is designed for Model objects with annotations.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_installing-the-nuget">Installing the nuget</h3>
<div class="paragraph">
<p>You need to install the <code>AWSSDK.DynamoDBV2</code> nuget, for that you can run the following command in the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package AWSSDK.DynamoDBv2</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_working-with-table-repository">Working with Table Repository</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-the-object">Step 1 - Create the object</h4>
<div class="paragraph">
<p>Create the object you want to use to interact with the database; in this example, we built a user object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public class User
    {
        public string Key { get; set; }
        public string Name { get; set; }
        public string Surname {get; set;}
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---register-the-dynamodbtablerepository-service">Step 2 - Register the DynamoDbTableRepository service</h4>
<div class="paragraph">
<p>The code below registers the <code>IDynamoDbTableRepository</code> service with the concrete type <code>DynamoDbTableRepository</code>. The AddTransient method registers the service with a transient lifetime. These services are created each time they&#8217;re requested from the service container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">protected override void ConfigureServices(IServiceCollection services)
  {
    services.AddTransient&lt;IDynamoDbTableRepository, DynamoDbTableRepository&gt;();
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---inject-the-table-repository">Step 3 - Inject the Table Repository</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">private IDynamoDbTableRepository DynamoDbTableRepository { get; set; }
        public RepositoryService(IDynamoDbTableRepository dynamoDbTableRepository)
        {
            DynamoDbTableRepository = dynamoDbTableRepository;
        }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---create-a-table">Step 4 - Create a table</h4>
<div class="paragraph">
<p>In this scenario, we want to create a table called <code>users</code>. The code below first checks if the table <code>users</code> already exists, and if it doesn&#8217;t, then uses the <code>CreateTable</code> method from the <code>DynamoDbTableRepository</code> to create it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async void CreateTable()
        {
            if (!await DynamoDbTableRepository.TableExists("users").ConfigureAwait(false))
            {
                await DynamoDbTableRepository.CreateTable("users",
                    new List&lt;KeySchemaElement&gt; { new KeySchemaElement { AttributeName = DynamoDbGeneralObjectStorageAttributes.AttributeKey, KeyType = KeyType.HASH } },
                    new List&lt;AttributeDefinition&gt; { new AttributeDefinition { AttributeName = DynamoDbGeneralObjectStorageAttributes.AttributeKey, AttributeType = ScalarAttributeType.S } }).ConfigureAwait(false);
            }

        }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---insert-values-into-the-table">Step 5 - Insert values into the table</h4>
<div class="paragraph">
<p>Now let&#8217;s insert data into the table using the repository&#8217;s <code>Put</code> method. We must specify the table name, partition key, and object to insert.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async Task&lt;User&gt; InsertUser()
        {
            var user = new User {
                Key = "User-01",
                Name = "Josh",
                Surname = "Martin"
            };

            await DynamoDbTableRepository.Put("users", user.Key, user).ConfigureAwait(false);
            var criteria = new DynamoSearchCriteria();
            criteria.AddQueryCriteria(DynamoDbGeneralObjectStorageAttributes.AttributeKey, user.Key, QueryOperator.Equal); // For query method
            var result = await DynamoDbTableRepository.Get&lt;User&gt;("users", criteria.GetCriteriaScanFilterForSearchCriteria()).ConfigureAwait(false);
            return result.FirstOrDefault();
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the code above, we can obtain the result using <code>DynamoSearchCriteria()</code> We will describe query and scan methods later in this guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_working-with-entity-repository">Working with Entity Repository</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-1---create-the-entity">Step 1 - Create the Entity</h4>
<div class="paragraph">
<p>Create the entity you want to use to interact with the database; in this example, we built a Users entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">[DynamoDBTable("users")]
public class UsersTable
    {
        [DynamoDBHashKey]
        [DynamoDBProperty("key")]
        public string Key { get; set; }

        [DynamoDBProperty("name")]
        public string Name { get; set; }

        [DynamoDBProperty("surname")]
        public string Surname {get; set;}

        [DynamoDBIgnore]
        public int Age {get; set;}
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we use some annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[DynamoDBTable("tableName")]</code>: The name of the table that will be created for this entity.</p>
</li>
<li>
<p><code>[DynamoDBHashKey]</code>: Is used to set a property as Partition Key.</p>
</li>
<li>
<p><code>[DynamoDBProperty("propertyName")]</code>: The name of the property that will be shown in the database.</p>
</li>
<li>
<p><code>[DynamoDBIgnore]</code>: For avoiding this property when saving or loading data.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-2---register-the-dynamodbentityrepository-service">Step 2 - Register the DynamoDbEntityRepository service</h4>
<div class="paragraph">
<p>The code below registers the <code>IDynamoDbEntityRepository</code> service with the concrete type <code>DynamoDbEntityRepository</code>. The AddTransient method registers the service with a transient lifetime. These services are created each time they&#8217;re requested from the service container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">protected override void ConfigureServices(IServiceCollection services)
  {
    services.AddTransient&lt;IDynamoDbEntityRepository&lt;UsersTable&gt;, DynamoDbEntityRepository&lt;UsersTable&gt;&gt;();
  }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-3---inject-the-entity-repository">Step 3 - Inject the Entity Repository</h4>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">private IDynamoDbEntityRepository&lt;UsersTable&gt; DynamoDbEntityRepository { get; set; }
        public DynamoDbFunctionEventHandler(IDynamoDbEntityRepository&lt;UsersTable&gt; dynamoDbEntityRepository)
        {
            DynamoDbEntityRepository = dynamoDbEntityRepository;
        }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-4---create-a-table">Step 4 - Create a table</h4>
<div class="paragraph">
<p>In this example, we want to create a table called <code>users</code>. The code below first checks if the table <code>users</code> already exists, and if it doesn&#8217;t, then uses the <code>CreateTable</code> method from the <code>DynamoDbEntityRepository</code> to create it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async void CreateTable()
        {
            if (!await DynamoDbEntityRepository.TableExists("users").ConfigureAwait(false))
            {
                await DynamoDbEntityRepository.CreateTable("users",
                    new List&lt;KeySchemaElement&gt; { new KeySchemaElement { AttributeName = DynamoDbGeneralObjectStorageAttributes.AttributeKey, KeyType = KeyType.HASH } },
                    new List&lt;AttributeDefinition&gt; { new AttributeDefinition { AttributeName = DynamoDbGeneralObjectStorageAttributes.AttributeKey, AttributeType = ScalarAttributeType.S } }).ConfigureAwait(false);
            }

        }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_step-5---insert-values-into-the-table">Step 5 - Insert values into the table</h4>
<div class="paragraph">
<p>Now let&#8217;s insert data into the table using the repository&#8217;s <code>Create</code> method. In this case, we simply need to specify the entity itself as a parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">public async Task&lt;User&gt; InsertUser()
        {
            await DynamoDbEntityRepository.Create(new UsersTable { Key = "User-01", Name = "Josh", Surname = "Martin"}).ConfigureAwait(false);

            return await DynamoDbEntityRepository.GetById("User-01").ConfigureAwait(false);
        }</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also use the the repository&#8217;s <code>GetById</code> method to obtain the added user.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_searching-methods">Searching methods</h3>
<div class="paragraph">
<p>Devon4net includes the <code>DynamoSearchCriteria</code> class, which makes it easier to use the DynamoDB SDK searching methods.</p>
</div>
<div class="paragraph">
<p>In DynamoDB SDK, there are two possible operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Scan:</strong>  Searches the whole table for elements that fit the criteria. Is slower than Query operations.</p>
</li>
<li>
<p><strong>Query:</strong> Performs a direct lookup to a selected partition based on primary or secondary partition/hash key.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In devon4net you must create a new instance of <code>DynamoSearchCriteria</code> class, for accessing those methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">var criteria = new DynamoSearchCriteria();

            criteria.AddSearchCriteria(DynamoDbGeneralObjectStorageAttributes.AttributeKey, user.Name, ScanOperator.Equal);// For scan method

            criteria.AddQueryCriteria(DynamoDbGeneralObjectStorageAttributes.AttributeKey, user.Key, QueryOperator.Equal);// For query method</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>AddSearchCriteria</code> and <code>AddQueryCriteria</code> methods have fairly similar syntax, as shown in the code above.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
For more information about query and scan methods please visit the DynamoDB component documentation
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use-aws-cdk">How to: Use AWS CDK</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_what-is-aws-cdk">What is AWS CDK?</h3>
<div class="paragraph">
<p>AWS Cloud Development Kit (CDK) is an open-source software development framework to define your cloud application resources using familiar programming languages. This framework allows you to define all your AWS infrastructure as readable code. This process is known as Infrastructure as Code (IaC) and consists in provisioning and managing infrastructure for your software solutions through code, instead of doing so manually.</p>
</div>
<div class="paragraph">
<p>This means that you can easily modify, distribute and reproduce configurations. In addition, by including infrastructure as code:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>facilitates the integration of infrastructure into version control systems for tracking changes and audit modifications.</p>
</li>
<li>
<p>enables the introduction of significant automation for infrastructure management. All of these factors contribute to the SDLC&#8217;s IaC being fully integrated into CI/CD pipelines.</p>
</li>
<li>
<p>Eliminates the unnecessary manual management.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_why-cdk-support-in-devon4net">Why CDK support in devon4net?</h3>
<div class="paragraph">
<p>In a real project, we will use AWS services such as DynamoDB databases, S3 buckets, multiple lambdas, and so on.
Similarly, we will be working in a variety of work environments.</p>
</div>
<div class="paragraph">
<p>Devon4Net, with the help of the CDK, allows us to treat these services as code (IaC), which allows us to take all of this service structure and replicate it in another environment that interests us, saving development time and treating this copy of your AWS services as a backup.</p>
</div>
<div class="paragraph">
<p>In Devon4Net, we can use a standarized <code>json</code> file to configure the AWS CDK service, this <code>json</code> will be translated into readable code for the CDK framework.</p>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_how-to-use">How to use</h3>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_installing-the-nuget">Installing the NuGet</h4>
<div class="paragraph">
<p>You need to install the <code>Devon4net.Infrastructure.AWS.CDK</code> NuGet, for that you can run the following command in the Package Manager Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="console language-console">Install-Package Devon4net.Infrastructure.AWS.CDK</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="devonfw-guide_devon4net.wiki_howto.asciidoc_configure-your-provisionstack">Configure your <code>ProvisionStack</code></h4>
<div class="paragraph">
<p>In the <strong>Startup</strong> class of your application, follow the nexts steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Load your <code>appsettings.{environment}.json</code> configuration file. As an example, consider the Options Pattern:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">private static List&lt;CdkOptions&gt; LoadConfigurationFiles()
{
    var file = FileOperationsHelper.GetFilesFromPath("appsettings.json")?.FirstOrDefault();
    if (file == null) throw new ArgumentException("No appsettings.json was provided");

    var configuration = new ConfigurationBuilder().AddJsonFile(file, true, true).Build();

    var environmentFileName = Configuration.GetSection("Environment").Value;

    var environmentFile = FileOperationsHelper.GetFilesFromPath($"appsettings.{environmentFileName}.json")?.FirstOrDefault();
    configuration = new ConfigurationBuilder().AddConfiguration(configuration).AddJsonFile(environmentFile, true, true).Build();

    return Configuration.GetSection("CdkOptions").Get&lt;List&lt;CdkOptions&gt;&gt;();
}</code></pre>
</div>
</div>
</li>
<li>
<p>Once your setup has been charged, you may create an instance of the <code>ProvisionStack</code> class and then call the <code>Process()</code> method:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="c# language-c#">var cdkOptions = LoadConfigurationFiles();

foreach (var stack in cdkOptions)
{
    if (string.IsNullOrWhiteSpace(AwsAccount))
    {
        AwsAccount = stack.ProvisionStack.AwsAccount;
    }

    if (string.IsNullOrWhiteSpace(AwsRegion))
    {
        AwsRegion = stack.ProvisionStack.AwsRegion;
    }

    var defaultPsrovisionStack = new ProvisionStack(AwsAccount, AwsRegion, stack);
    defaultPsrovisionStack.Process();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Process()</code> method is responsible for building the infrastructure that you specified in your configuration file.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title=""></i>
</td>
<td class="content">
For more information about the configuration of the component itself, please, visit the component documentation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="devonfw-guide_devon4net.wiki_howto.asciidoc_references">References</h3>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/cdk/v2/guide/home.html">AWS CDK official documentation</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/welcome/welcome.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_introduction-why-should-i-use-devonfw.asciidoc_features.html">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html#devonfw-guide_devon4j.wiki_architecture.asciidoc_technology-stack">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_getting-started.wiki_getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_devon4j.wiki_architecture.asciidoc.html">Architecture</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-guide_ide.wiki_devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devonfw-guide_general_master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-guide_ide.wiki_LICENSE.asciidoc.html">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script src="/website/assets/scripts/popper.min.js"></script>
    <script src="/website/assets/scripts/bootstrap.min.js"></script>
<div class="footnote"><sub>

Last updated 2022-10-07 09:07:23 UTC
</sub></div>
</div>
</div>
<link rel="stylesheet" type="text/css" href="https://cginternal.devonfw.com/websitesnippets/main.css">
<script async src="https://cginternal.devonfw.com/websitesnippets/main.js"></script>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
<script>
      let cookieName = 'cookie_consent';
      let expiryTime = new Date(2037, 11, 21);
      let today = new Date();
      let cookieConsentDeclinedDate = localStorage.getItem("cookie_consent_declined");
      let dateDiffHours = 0;
      let cookieConsentHtml = `
      <div id="cookie-consent">
        <p>
          We use cookies to perform analytics and enhance user experience. Do you accept to the use of cookies?
        </p>
        <p class="cookie-consent-buttons">
          <a id="decline-cookie-btn" class="btn white-button" href="javascript:void(0)">Decline</a>
          <a id="accept-cookie-btn" class="btn blue-button" href="javascript:void(0)">Accept</a>
        </p>
      </div>
      `;
      
      const parseCookie = str =>
        str
        .split(';')
        .map(v => v.split('='))
        .reduce((acc, v) => {
          acc[decodeURIComponent(v[0].trim())] = decodeURIComponent(v[1].trim());
          return acc;
        }, {});
      
      dateDiffHours = cookieConsentDeclinedDate ? Math.abs(cookieConsentDeclinedDate - today) / 36e5 : 0;
      if (document.cookie.indexOf(cookieName) < 0) {
        if (cookieConsentDeclinedDate) {
          if (dateDiffHours > 24) {
            $("body").append(cookieConsentHtml);
          }
        } else {
          $("body").append(cookieConsentHtml);
        }
      } else {
        cookies = parseCookie(document.cookie);
        if (cookies["cookie_consent"] == "accept") {
          consentGranted();
        }
      }
      
      $("#accept-cookie-btn").click(function() {
        document.cookie = `${cookieName}=accept;expires=${expiryTime};path=/`;
        localStorage.removeItem("cookie_consent_declined");
        consentGranted();
        $("#cookie-consent").hide();
      });
      $("#decline-cookie-btn").click(function() {
        localStorage.setItem("cookie_consent_declined", today);
        $("#cookie-consent").hide();
      });
</script>
</body>
</html>