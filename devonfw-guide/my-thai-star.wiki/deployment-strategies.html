<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=">
<meta name="generator" content="Asciidoctor 1.5.8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ******** SOCIAL MEDIA META ********** -->

<meta name="title" property="og:title" content="devonfw website">
<meta property="og:type" content="website">
<meta name="image" property="og:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="description" property="og:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta property="og:url" content="https://devonfw.com/index.html">

<meta name="twitter:title" content="devonfw website">
<meta name="twitter:description" content="devonfw is the standard open source software development platform; Serving the full Software Delivery Life Cycle.">
<meta name="twitter:image" content="https://devonfw.com/images/devonfwwebsite.png">
<meta name="twitter:card" content="summary_large_image">

<!-- ************************************* -->


<title>Deployment Strategies</title>
<!-- devonfw website stylesheet -->
<link rel="stylesheet" type="text/css" href="/devonfw.css">
<!-- Ubuntu Font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400&display=swap" rel="stylesheet">
<!-- Lunr -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.6/lunr.min.js" integrity="sha256-M/Awbb/BYh+Rh0aGjpQid26p1b2OBsrk2k9yAvQxPV0=" crossorigin="anonymous"></script>
<!-- JQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/styles/googlecode.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/7.4/lang/common.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>

<script src="/website/components/header/search-engine/bundle.js"></script>

<!-- ************** Google analytics ************ -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151636804-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151636804-1');
</script>

<!-- ******************************************** -->

</head>
<body class="article">
<div id="website-navbar" class="website-navbar">
<button id="menu-button" class="menu-button">
  <img src="/images/menu-button.svg" width="32px" height="32px" alt=""/>
</button>

<ul>
<li>
<p><span class="image"><a class="image" href="/website/pages/welcome/welcome.html"><img alt="logo" src="/images/Logo_devonfw.svg"></a></span></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">DOCS</a></p>
</li>
</ul>

<form class="form-inline">
  <div class="search-bar">
    <input
      id="search-field"
      type="search"
      class="form-control mr-sm-2"
      placeholder="Search by keyword(s)..."
      aria-label="Search"
      style="height: auto;"
      autocomplete="off"/>
    <div class="sb-res-pos px-4">
      <div id="click-outside" class="click-outside z-50 hidden"></div>
      <div class="col rounded px-0 border z-100 bg-white hidden search-bar-results" id="search-results-box">
      </div>
    </div>
  </div>
</form>
<a class="navbar-github text-white" href="https://github.com/devonfw/">
  <img src="/images/github-mark.png" width=auto height=auto alt="">
</a></div>
<div id="sidebar" class="wiki-sidebar"></div>

<div id="content" class="mt-4 mt-sm-5">
<div class="toc2">
<div class="title">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#deployment-strategies.asciidoc">Deployment Strategies</a>
<ul class="sectlevel1">
<li><a href="#deployment-strategies.asciidoc_independent-docker-containers">Independent Docker containers</a></li>
<li><a href="#deployment-strategies.asciidoc_docker-compose">Docker Compose</a>
<ul class="sectlevel2">
<li><a href="#deployment-strategies.asciidoc_project-adjustment">Project adjustment</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="deployment-strategies.asciidoc" class="sect0">Deployment Strategies</h1>
<div class="paragraph">
<p>In this chapter different way of deploying My Thai Star are explained. Everything will be based in Docker.</p>
</div>
<div class="sect1">
<h2 id="deployment-strategies.asciidoc_independent-docker-containers">Independent Docker containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The first way of deployment will use isolated Docker containers. That means that if the client-side container is deployed, it does not affect the server-side container&#8217;s life cycle and vice versa.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s show how the containers will behave during their life cycle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>0) Copy everything you need into the Deployment Server directory</p>
</li>
<li>
<p>1) Remove existing container (Nginx or Tomcat)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container1.png"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/angular/container1.png" alt="container1"></a>
</div>
</div>
</li>
<li>
<p>2) Run new one from the Docker images collection of the external Deployment Server.</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container2.png"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/angular/container2.png" alt="container2"></a>
</div>
</div>
</li>
<li>
<p>3) Add the artifact <code>/dist</code> to the "deployable" folder of the Docker container (<code>/usr/share/nginx/html/</code>)</p>
<div class="imageblock">
<div class="content">
<a class="image" href="container3.png"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/angular/container3.png" alt="container3"></a>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s see how it&#8217;s being executed in the command line (simplified due to documentation purposes). The next block of code represents what is inside of the last stage of the Pipeline.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="groovy language-groovy">sshagent (credentials: ['my_ssh_token']) {
    sh """
        // Copy artifact from workspace to deployment server

        // Manage container:
        docker rm -f [mts-container]
        docker run -itd --name=[mts-container] [base_image]
        docker exec [mts-container] bash -C \\"rm [container_deployment_folder]/*\\"
        docker cp [artifact] [mts-container]:[container_deployment_folder]
    """
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For every operation performed in the external Deployment Server, it is necessary to define <em>where</em> those commands are going to be executed. So, for each one of previous <code>docker</code> commands, this should appear before:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ssh -o StrictHostKeyChecking=no root@10.40.235.244</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deployment-strategies.asciidoc_docker-compose">Docker Compose</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The second way of deployment will be by orchestrating both elements of the application: The Angular client-side and the Java server-side. Both elements will be running in Docker containers as well, but in this case they won&#8217;t be independent anymore. <strong>Docker Compose</strong> will be in charge of keeping both containers up, or to put them down.</p>
</div>
<div class="sect2">
<h3 id="deployment-strategies.asciidoc_project-adjustment">Project adjustment</h3>
<div class="paragraph">
<p>In order to perform this second way of deployment, some files will be created in the project. The first one is the <strong>Dockerfile</strong> for the Angular client-side. This file will pull (if necessary) an <strong>nginx</strong> Docker image and copy the Angular artifact (<code>/dist</code> folder) inside of the deployment folder of the image. It will be located in the main directory of the Angular client-side project.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-angular.PNG"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/deployment/dockerfile-angular.PNG" alt="dockerfile angular"></a>
</div>
</div>
<div class="paragraph">
<p>The second file is the <strong>Dockerfile</strong> for the Java server-side. Its function will be quite similar to the Angular one. It will run a <strong>tomcat</strong> Docker image and copy the Java artifact (<code>mythaistar.war</code> file) in its deployment folder.</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="dockerfile-java.PNG"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/deployment/dockerfile-java.PNG" alt="dockerfile java"></a>
</div>
</div>
<div class="paragraph">
<p>Finally, as long as the <strong>docker-compose</strong> is being used, a file containing its configuration will be necessary as well. A new folder one the main My That Star&#8217;s directory is created, and it&#8217;s called <code>/docker</code>. Inside there is just a <code>docker-compose.yml</code> file. It contains all the information needed to orchestrate the deployment process. For example, which port both containers are going to be published on, and so on. This way of deployment will allow the application to be published or not just with one action.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>docker-compose rm -f            # down
docker-compose up --build -d    # up fresh containers</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="docker-compose.PNG"><img src="/home/runner/work/devonfw.github.io/devonfw.github.io/target/generated-docs/images/ci/deployment/docker-compose.PNG" alt="docker compose"></a>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s have a look at the file itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="yaml language-yaml">version: '3'
services:
  client_compose:
    build: "angular"
    ports:
      - "8091:80"
    depends_on:
      - server_compose
  server_compose:
    build: "java"
    ports:
      - "9091:8080"</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Orchestrated Deployment will offer some interesting possibilities for <a href="#future-deployment.asciidoc">the future of the application</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer" class="footer">
<div class="openblock footerLinks">
<div class="content">
<div class="dlist linklist">
<dl>
<dt class="hdlist1">About</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html">About devonfw</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_introduction.html#introduction-why-should-i-use-devonfw.asciidoc">Features</a></p>
</li>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc_further-information.html">Technology Stack</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Explore</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/getting-started.asciidoc.html">Getting started</a></p>
</li>
<li>
<p><a href="/website/pages/docs/devon4j.asciidoc_architecture.html">Architecture</a></p>
</li>
<li>
<p><a href="/website/pages/resources/resources.html">Resources</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Docs</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="/website/pages/docs/devonfw-ide-introduction.asciidoc.html">User guide</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master-release-notes.asciidoc.html">Releases information</a></p>
</li>
<li>
<p><a href="/website/pages/docs/master.html">Wiki</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="dlist linklist">
<dl>
<dt class="hdlist1">Community</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/orgs/devonfw/people">Contributors</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw/devonfw.github.io/blob/develop/README.asciidoc">Website Contribution</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="ulist footerFooter">
<ul>
<li>
<p><a href="https://devonfw.com/website/pages/docs/devonfw-ide-support.asciidoc.html#LICENSE.asciidoc">Terms of Use</a></p>
</li>
<li>
<p><a href="https://github.com/devonfw">Support</a></p>
</li>
</ul>
</div>
</div>
    <script>
      let bb = document.getElementById('menu-button');
      bb.addEventListener('click', function() {
        document.querySelector('.website-navbar ul').classList.toggle('visible');
        console.log(document.querySelector('.website-navbar ul'))
      })
    </script>
    <script type="module">
      import { EditLinksModule } from '/website/shared/editlinks.js';

      let alwaysVisible = true;
      if(document.location.pathname.endsWith("pages/welcome/welcome.html")) {
        alwaysVisible = false;
      }
      EditLinksModule.addEditLinks(alwaysVisible);
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
<div class="footnote"><sub>

Last updated 2021-11-21 14:55:36 UTC
</sub></div>
</div>
</div>
<script>
  if(!document.location.pathname.endsWith("pages/welcome/welcome.html")) {
    anchors.options.visible = 'always';
  }
  anchors.add();
</script>
<script>
  var internalUrls = ["https://cginternal.devonfw.com/websitesnippets/"];
  $(".internal").each(function(){
    internalUrls.forEach((internalUrl, index) => {
      $.ajax({url: internalUrl + $(this).text() + "/index.html" })
      .then(r => {
        var leftDiv = $('<div class="info"><span class="infoText">Internal</span><img class="infoImage" src="' + internalUrl + 'logo.png"/></div>');
        var rightFirstDiv = $('<div class="message">This is only visible inside of the corporate network.</div>');
        var rightLastDiv = $('<div class="content"></div>');
        rightLastDiv.html(r);
        var rightDiv = $('<div class="right"></div>');
        rightDiv.append(rightFirstDiv);
        rightDiv.append(rightLastDiv);
        $(this).html(leftDiv);
        $(this).append(rightDiv);
        $(this).addClass("internal-active");
        $(this).removeClass("internal");
      })
    });
	});
</script>
</body>
</html>